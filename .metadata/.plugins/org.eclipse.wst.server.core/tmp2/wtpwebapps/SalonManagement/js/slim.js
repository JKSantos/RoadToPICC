/**
 * Created by Castillo on 7/13/2016.
 */
!function(t,e){"use strict";var i=1,n={},o={_setEntry:function(t,e){var o=t.__pubSubUID;return o||(o=i++,t.__pubSubUID=o,n[o]={obj:t}),n[o][e]||(n[o][e]=[]),n[o]},_getEntryProp:function(t,e){var i=n[t.__pubSubUID];return i?n[t.__pubSubUID][e]:null},_clearEntry:function(t){var e=n[t.__pubSubUID];!e||e.subscriptions&&e.subscriptions.length||e.receivers&&e.receivers.length||(e.subscriptions=null,e.receivers=null,e.obj=null,delete n[t.__pubSubUID],t.__pubSubUID=null)},subscribe:function(t,e,i){for(var n,o=this._setEntry(t,"subscriptions"),r=0,s=o.subscriptions,a=s.length;a>r;r++)if(n=s[r],n.type===e&&n.fn===i)return;s.push({type:e,fn:i})},unsubscribe:function(t,e,i){var n=this._getEntryProp(t,"subscriptions");if(n){for(var o,r=n.length;--r>=0;)o=n[r],o.type!==e||o.fn!==i&&i||n.splice(r,1);n.length||this._clearEntry(t)}},publishAsync:function(t,e,i){var n=this;setTimeout(function(){n.publish(t,e,i)},0)},publish:function(t,e,i){for(var n,o=this._setEntry(t,"subscriptions"),r=[],s=0,a=o.subscriptions,u=a.length,l=o.receivers;u>s;s++)n=a[s],n.type===e&&r.push(n);for(u=r.length,s=0;u>s;s++)r[s].fn(i);if(l&&(l.length||a.length)||this._clearEntry(t),l)for(u=l.length,s=0;u>s;s++)this.publish(l[s],e,i)},inform:function(t,e){if(!t||!e)return!1;var i=this._setEntry(t,"receivers");return i.receivers.push(e),!0},conceal:function(t,e){if(!t||!e)return!1;var i=this._getEntryProp(t,"receivers");if(!i)return!1;for(var n,o=i.length,r=!1;--o>=0;)n=i[o],n===e&&(i.splice(o,1),r=!0);return i.length||this._clearEntry(t),r}};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define("utils/Observer",[],function(){return o}):t.Observer=o}(this),function(t,e){"use strict";var i=function(){this._thens=[]};i.prototype={then:function(t,e){this._thens.push({resolve:t,reject:e})},resolve:function(t){this._complete("resolve",t)},reject:function(t){this._complete("reject",t)},_complete:function(t,e){this.then="resolve"===t?function(t,i){t(e)}:function(t,i){i(e)},this.resolve=this.reject=function(){throw new Error("Promise already completed.")};for(var i,n=0;i=this._thens[n++];)i[t]&&i[t](e);delete this._thens}},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("utils/Promise",[],function(){return i}):t.Promise=i}(this),function(t,e){"use strict";var i,n=t.document?t.document.body:null;i=n&&n.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:n&&n.contains?function(t,e){return t!=e&&t.contains(e)}:function(t,e){for(var i=e.parentNode;i;){if(i===t)return!0;i=i.parentNode}return!1},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("utils/contains",[],function(){return i}):t.contains=i}(this),function(t,e){"use strict";var i=null,n=null,o=t.document?t.document.body:null;!o||o.matches?n="matches":(o.webkitMatchesSelector?n="webkit":o.mozMatchesSelector?n="moz":o.msMatchesSelector?n="ms":o.oMatchesSelector&&(n="o"),n+="MatchesSelector"),i=n?function(t,e){return t[n](e)}:function(e,i){for(var n=(e.parentNode||t.document).querySelectorAll(i)||[],o=n.length;o--;)if(n[o]==e)return!0;return!1},"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("utils/matchesSelector",[],function(){return i}):t.matchesSelector=i}(this),function(t,e){"use strict";var i=function(t,e){var n=Array.isArray(e),o=n&&[]||{};return e=e||{},n?o=e.concat():(t&&"object"==typeof t&&Object.keys(t).forEach(function(e){o[e]=t[e]}),Object.keys(e).forEach(function(n){"object"==typeof e[n]&&e[n]&&t[n]?o[n]=i(t[n],e[n]):o[n]=e[n]})),o};"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("utils/mergeObjects",[],function(){return i}):t.mergeObjects=i}(this),!function(t,e){"use strict";var i=function(e,i,n,o,r,s){var a,u,l,h=function(t,e){this._path=t,this._expected=e,this._watches=[],this._count=0,this._monitor=null};h.prototype={getPath:function(){return this._path},getExpected:function(){return this._expected},isTrue:function(){for(var t=0,e=this._count;e>t;t++)if(!this._watches[t].valid)return!1;return!0},assignMonitor:function(t){this._monitor=t},assignWatches:function(t){this._watches=t,this._count=t.length},getMonitor:function(){return this._monitor},getWatches:function(){return this._watches},toString:function(){return this._path+":{"+this._expected+"}"}};var c=function(t,e){this._expression=t,this._change=e,this._currentState=null};c.prototype={evaluate:function(){var t=this._expression.isTrue();t!=this._currentState&&(this._currentState=t,this._change(t))}};var d=function(){this._uid=1,this._db=[],this._expressions=[]};d.prototype={_parse:function(t,e){if(this._expressions[t])return this._expressions[t];for(var i,n,o,r=0,s=t.split(","),a=s.length,u=[];a>r;r++)i=s[r].split(":"),n=0===i[0].indexOf("was "),o=n?i[0].substr(4):i[0],u.push({retain:n,test:o,value:e?o:"undefined"==typeof i[1]?!0:i[1]});return this._expressions[t]=u,u},_mergeData:function(t,e,i){return s({element:i,expected:e},t)},create:function(t,e){var i=new n,o=t.getPath(),r=t.getExpected(),s=this;return a.loader.require([a.paths.monitors+o],function(n){var a,u,l,h,c,d,p,f,m=0,g=s._db[o],_=n.unload?s._uid++:o;if(!g){if(g={watches:[],change:function(t){for(m=0,a=g.watches.length;a>m;m++)g.watches[m].test(t)}},p=n.unload?s._mergeData(n.data,r,e):n.data,"function"==typeof n.unload&&(g.unload=function(t){return function(){n.unload(t)}}(p)),"function"==typeof n.trigger)n.trigger(g.change,p);else for(c in n.trigger)n.trigger.hasOwnProperty(c)&&n.trigger[c].addEventListener(c,g.change,!1);s._db[_]=g}for(t.assignMonitor(_),l=[],f="function"==typeof n.test,h=n.parse?n.parse(r,f):s._parse(r,f),a=h.length;a>m;m++)d=h[m],u={changed:null,retain:d.retain,retained:null,valid:null,data:n.unload?p:s._mergeData(n.data,d.value,e),test:function(t){return function(e){if(!this.retained){var i=t(this.data,e);this.valid!=i&&(this.valid=i,this.changed&&this.changed()),this.valid&&this.retain&&(this.retained=!0)}}}(f?n.test:n.test[d.test])},u.test(),l.push(u);g.watches=g.watches.concat(l),i.resolve(l)}),i},destroy:function(t){var e=t.getMonitor();if(null!==e){var i,n=this._db[e],o=n.watches,r=o.length;t.getWatches().forEach(function(t){for(i=0;r>i;i++)o[i]===t&&o.splice(i,1)}),n.unload&&(n.unload(),this._db[e]=null)}}};var p=function(t,e,i){var n=_.parse(t);this._element=e,this._tests=n.getTests(),this._condition=new c(n,i),this._conditionChangeBind=this._condition.evaluate.bind(this._condition),this._load()};p.prototype={_load:function(){for(var t=0,e=this._tests.length;e>t;t++)this._setupMonitorForTest(this._tests[t])},_setupMonitorForTest:function(t){var e,i=this,n=0;u.create(t,this._element).then(function(o){for(t.assignWatches(o),e=o.length;e>n;n++)o[n].changed=i._conditionChangeBind;i._condition.evaluate()})},destroy:function(){for(var t=0,e=this._tests.length;e>t;t++)u.destroy(this._tests[t]);this._conditionChangeBind=null}};var f={_uid:0,_db:[],clearTest:function(t){var e=this._db[t];return e?(this._db[t]=null,void e.destroy()):!1},setTest:function(t,e,i){var n=this._uid++;return this._db[n]=new p(t,e,i),n}},m=function(t,e){this._expression=t,this._negate="undefined"==typeof e?!1:e};m.prototype={isTrue:function(){return this._expression.isTrue()!==this._negate},getTests:function(){return this._expression instanceof h?[this._expression]:this._expression.getTests()},toString:function(){return(this._negate?"not ":"")+this._expression.toString()}};var g=function(t,e,i){this._a=t,this._operator=e,this._b=i};g.prototype={isTrue:function(){return"and"===this._operator?this._a.isTrue()&&this._b.isTrue():this._a.isTrue()||this._b.isTrue()},getTests:function(){return this._a.getTests().concat(this._b.getTests())},toString:function(){return"("+this._a.toString()+" "+this._operator+" "+this._b.toString()+")"}};var _=function(t,e){return{parse:function(i){var n,o,r,s,a,u,l,c,d,p,f,m=0,g="",_=[],v="",y=!1,w=!1,b=null,k=null,x=[],E=i.length;for(b||(b=_);E>m;m++)if(u=i.charCodeAt(m),123!==u)if(125===u&&(n=b.length-1,o=n+1,y="not"===b[n],o=y?n:n+1,s=new h(g,v),b[o]=new t(s,y),g="",v="",y=!1,w=!1),w)v+=i.charAt(m);else{if(40===u&&(b.push([]),x.push(b),b=b[b.length-1]),32===u||0===m||40===u){if(r=i.substr(m,5).match(/and |or |not /g),!r)continue;d=r[0],p=d.length-1,b.push(d.substring(0,p)),m+=p}if(41===u||m===E-1)do if(k=x.pop(),0!==b.length){for(a=0,f=b.length;f>a;a++)"string"==typeof b[a]&&("not"===b[a]?(b.splice(a,2,new t(b[a+1],!0)),a=-1,f=b.length):"not"!==b[a+1]&&(b.splice(a-1,3,new e(b[a-1],b[a],b[a+1])),a=-1,f=b.length));1===b.length&&k&&(k[k.length-1]=b[0],b=k)}else b=k;while(m===E-1&&k)}else for(w=!0,g="",l=m-2;l>=0&&(c=i.charCodeAt(l),32!==c&&40!==c);)g=i.charAt(l)+g,l--;return 1===_.length?_[0]:_}}}(m,g),v={init:function(t){t()},allowsActivation:function(){return!0},destroy:function(){}},y=function(t,e){"string"==typeof t&&t.length&&(this._conditions=t,this._element=e,this._state=!1,this._test=null)};y.prototype={init:function(t){var e=this,n=!1;this._test=f.setTest(this._conditions,this._element,function(o){e._state=o,i.publish(e,"change"),n||(n=!0,t())})},allowsActivation:function(){return this._state},destroy:function(){f.clearTest(this._test)}};var w={_options:{},_redirects:{},_enabled:{},registerModule:function(t,e,i,n){this._options[a.loader.toUrl(t)]=e,this._enabled[t]=n,i&&(this._redirects[i]=t),a.loader.config(t,e)},isModuleEnabled:function(t){return this._enabled[t]!==!1},getRedirect:function(t){return this._redirects[t]||t},getModule:function(t){return this._options[t]||this._options[a.loader.toUrl(t)]}},b=function(t,e,i,n){this._path=w.getRedirect(t),this._alias=t,this._element=e,this._options=i,this._agent=n||v,this._Module=null,this._module=null,this._initialized=!1,this._onAgentStateChangeBind=this._onAgentStateChange.bind(this);var o=this;this._agent.init(function(){o._initialize()})};b.prototype={hasInitialized:function(){return this._initialized},getElement:function(){return this._element},getModulePath:function(){return this._path},isModuleAvailable:function(){return this._agent.allowsActivation()&&!this._module},isModuleActive:function(){return null!==this._module},wrapsModuleWithPath:function(t){return this._path===t||this._alias===t},_initialize:function(){this._initialized=!0,i.subscribe(this._agent,"change",this._onAgentStateChangeBind),i.publishAsync(this,"init",this),this._agent.allowsActivation()&&this._onBecameAvailable()},_onBecameAvailable:function(){i.publishAsync(this,"available",this),this._load()},_onAgentStateChange:function(){var t=this._agent.allowsActivation();this._module&&!t?this._unload():!this._module&&t&&this._onBecameAvailable()},_load:function(){if(this._Module)return void this._onLoad();var t=this;a.loader.require([this._path],function(e){t._agent&&(t._Module=e,t._onLoad())})},_applyOverrides:function(t,e){if("string"==typeof e){if(123!=e.charCodeAt(0)){for(var i=0,n=e.split(", "),o=n.length;o>i;i++)this._overrideObjectWithUri(t,n[i]);return t}e=JSON.parse(e)}return s(t,e)},_overrideObjectWithUri:function(t,e){for(var i,n=t,o="",r=0,s=e.length;s>r;){if(i=e.charCodeAt(r),46!=i&&58!=i)o+=e.charAt(r);else{if(58==i){n[o]=this._castValueToType(e.substr(r+1));break}n=n[o],o=""}r++}},_castValueToType:function(t){return 39==t.charCodeAt(0)?t.substring(1,t.length-1):isNaN(t)?"true"==t||"false"==t?"true"===t:-1!==t.indexOf(",")?t.split(",").map(this._castValueToType):t:parseFloat(t)},_parseOptions:function(t,e,i){var n,o,r=[],a={},u={};do n=w.getModule(t),r.push({page:n,module:e.options}),t=e.__superUrl;while(e=e.__super);for(o=r.length;o--;)a=s(a,r[o].page),u=s(u,r[o].module);return n=s(u,a),i&&(n=this._applyOverrides(n,i)),n},_onLoad:function(){if(this._agent.allowsActivation()){var t=this._parseOptions(this._path,this._Module,this._options);"function"==typeof this._Module?this._module=new this._Module(this._element,t):(this._module=this._Module.load?this._Module.load(this._element,t):null,this._module||(this._module=this._Module)),i.inform(this._module,this),i.publishAsync(this,"load",this)}},_unload:function(){return this._module?(i.conceal(this._module,this),this._module.unload&&this._module.unload(),this._module=null,i.publish(this,"unload",this),!0):!1},destroy:function(){i.unsubscribe(this._agent,"change",this._onAgentStateChangeBind),this._unload(),this._agent.destroy(),this._onAgentStateChangeBind=null},execute:function(t,e){if(!this._module)return{status:404,response:null};var i=this._module[t];return e=e||[],{status:200,response:i.apply(this._module,e)}}};var k=function(){var t=function(t){return t.isModuleActive()},e=function(t){return t.isModuleAvailable()},n=function(t){return t.getModulePath()},s=function(t,e){this._element=t,this._element.setAttribute(a.attr.processed,"true"),this._priority=e?parseInt(e,10):0,this._moduleControllers=[],this._moduleAvailableBind=this._onModuleAvailable.bind(this),this._moduleLoadBind=this._onModuleLoad.bind(this),this._moduleUnloadBind=this._onModuleUnload.bind(this)};return s.hasProcessed=function(t){return"true"===t.getAttribute(a.attr.processed)},s.prototype={load:function(t){if(t&&t.length){this._moduleControllers=t;for(var e,n=0,o=this._moduleControllers.length;o>n;n++)e=this._moduleControllers[n],i.subscribe(e,"available",this._moduleAvailableBind),i.subscribe(e,"load",this._moduleLoadBind)}},destroy:function(){for(var t=0,e=this._moduleControllers.length;e>t;t++)this._destroyModule(this._moduleControllers[t]);this._moduleAvailableBind=null,this._moduleLoadBind=null,this._moduleUnloadBind=null,this._updateAttribute(a.attr.initialized,this._moduleControllers),this._moduleControllers=null,this._element.removeAttribute(a.attr.processed)},_destroyModule:function(t){i.unsubscribe(t,"available",this._moduleAvailableBind),i.unsubscribe(t,"load",this._moduleLoadBind),i.unsubscribe(t,"unload",this._moduleUnloadBind),i.conceal(t,this),t.destroy()},getPriority:function(){return this._priority},getElement:function(){return this._element},matchesSelector:function(t,e){return!t&&e?o(e,this._element):e&&!o(e,this._element)?!1:r(this._element,t)},areAllModulesActive:function(){return this.getActiveModules().length===this._moduleControllers.length},getActiveModules:function(){return this._moduleControllers.filter(t)},getModule:function(t){return this._getModules(t,!0)},getModules:function(t){return this._getModules(t)},_getModules:function(t,e){if("undefined"==typeof t)return e?this._moduleControllers[0]:this._moduleControllers.concat();for(var i,n=0,o=this._moduleControllers.length,r=[];o>n;n++)if(i=this._moduleControllers[n],i.wrapsModuleWithPath(t)){if(e)return i;r.push(i)}return e?null:r},execute:function(t,e){return this._moduleControllers.map(function(i){return{controller:i,result:i.execute(t,e)}})},_onModuleAvailable:function(t){i.inform(t,this),this._updateAttribute(a.attr.loading,this._moduleControllers.filter(e))},_onModuleLoad:function(t){i.unsubscribe(t,"load",this._moduleLoadBind),i.subscribe(t,"unload",this._moduleUnloadBind),this._updateAttribute(a.attr.loading,this._moduleControllers.filter(e)),this._updateAttribute(a.attr.initialized,this.getActiveModules())},_onModuleUnload:function(t){i.subscribe(t,"load",this._moduleLoadBind),i.unsubscribe(t,"unload",this._moduleUnloadBind),this._updateAttribute(a.attr.initialized,this.getActiveModules());var e=this;setTimeout(function(){i.conceal(t,e)},0)},_updateAttribute:function(t,e){var i=e.map(n);i.length?this._element.setAttribute(t,i.join(",")):this._element.removeAttribute(t)}},s}(),x=function(t){this._inSync=!1,this._controllers=t,this._controllerLoadedBind=this._onLoad.bind(this),this._controllerUnloadedBind=this._onUnload.bind(this);for(var e,n=0,o=this._controllers.length;o>n;n++)e=this._controllers[n],i.subscribe(e,"load",this._controllerLoadedBind),i.subscribe(e,"unload",this._controllerUnloadedBind);this._test()};x.prototype={destroy:function(){for(var t,e=0,n=this._controllers.length;n>e;e++)t=this._controllers[e],t&&(i.unsubscribe(t,"load",this._controllerLoadedBind),i.unsubscribe(t,"unload",this._controllerUnloadedBind));this._controllerLoadedBind=null,this._controllerUnloadedBind=null,this._controllers=null},areAllModulesActive:function(){for(var t,e=0,i=this._controllers.length;i>e;e++)if(t=this._controllers[e],!this._isActiveController(t))return!1;return!0},_onLoad:function(){this._test()},_onUnload:function(){this._unload()},_isActiveController:function(t){return t.isModuleActive&&t.isModuleActive()||t.areAllModulesActive&&t.areAllModulesActive()},_test:function(){this.areAllModulesActive()&&this._load()},_load:function(){this._inSync||(this._inSync=!0,i.publishAsync(this,"load",this._controllers))},_unload:function(){this._inSync&&(this._inSync=!1,i.publish(this,"unload",this._controllers))}};var E=new RegExp("^\\[\\s*{"),C=function(){this._nodes=[]};return C.prototype={parse:function(t){var e,i,n=t.querySelectorAll("[data-module]"),o=n.length,r=0,s=[];if(!n)return[];for(;o>r;r++)i=n[r],k.hasProcessed(i)||s.push(new k(i,i.getAttribute(a.attr.priority)));for(s.sort(function(t,e){return t.getPriority()-e.getPriority()}),r=s.length;--r>=0;)e=s[r],e.load.call(e,this._getModuleControllersByElement(e.getElement()));return this._nodes=this._nodes.concat(s),s},load:function(t,e){e=e.length?e:[e];var i,n,o=0,r=e.length,s=[];for(n=new k(t);r>o;o++)i=e[o],s.push(this._getModuleController(i.path,t,i.options,i.conditions));return n.load(s),this._nodes.push(n),n},getNodeByElement:function(t){for(var e,i=0,n=this._nodes.length;n>i;i++)if(e=this._nodes[i],e.getElement()===t)return e;return null},getNodes:function(t,e,i){if("undefined"==typeof t&&"undefined"==typeof e)return i?this._nodes[0]:this._nodes.concat();for(var n,o=0,r=this._nodes.length,s=[];r>o;o++)if(n=this._nodes[o],n.matchesSelector(t,e)){if(i)return n;s.push(n)}return i?null:s},destroy:function(t){for(var e,i=t.length,n=0;i--;)e=this._nodes.indexOf(t[i]),-1!==e&&(this._nodes.splice(e,1),t[i].destroy(),n++);return t.length===n},_getModuleControllersByElement:function(t){var e=t.getAttribute(a.attr.module)||"";if(91==e.charCodeAt(0)){var i,n,o,r=[],s=0;try{n=JSON.parse(e)}catch(u){}if(!n)return[];if(i=n.length,E.test(e)){for(;i>s;s++)o=n[s],w.isModuleEnabled(o.path)&&(r[s]=this._getModuleController(o.path,t,o.options,o.conditions));return r}for(;i>s;s++)o=n[s],w.isModuleEnabled("string"==typeof o?o:o[0])&&("string"==typeof o?r[s]=this._getModuleController(o,t):r[s]=this._getModuleController(o[0],t,"string"==typeof o[1]?o[2]:o[1],"string"==typeof o[1]?o[1]:o[2]));return r}return w.isModuleEnabled(e)?[this._getModuleController(e,t,t.getAttribute(a.attr.options),t.getAttribute(a.attr.conditions))]:null},_getModuleController:function(t,e,i,n){return new b(t,e,i,n?new y(n,e):v)}},a={paths:{monitors:"./monitors/"},attr:{options:"data-options",module:"data-module",conditions:"data-conditions",priority:"data-priority",initialized:"data-initialized",processed:"data-processed",loading:"data-loading"},loader:{require:function(t,i){e(t,i)},config:function(t,e){var i={};i[t]=e,requirejs.config({config:i})},toUrl:function(t){return requirejs.toUrl(t)}},modules:{}},u=new d,l=new C,{init:function(e){return e&&this.setOptions(e),l.parse(t.document)},setOptions:function(t){var e,i,n,o,r;a=s(a,t);for(i in a.paths)a.paths.hasOwnProperty(i)&&(a.paths[i]+="/"!==a.paths[i].slice(-1)?"/":"");for(i in a.modules)a.modules.hasOwnProperty(i)&&(n=a.modules[i],o="string"==typeof n?n:n.alias,e="string"==typeof n?null:n.options||{},r="string"==typeof n?null:n.enabled,w.registerModule(i,e,o,r))},parse:function(t){return l.parse(t)},load:function(t,e){return l.load(t,e)},sync:function(){var t=Object.create(x.prototype);return x.apply(t,[arguments[0].slice?arguments[0]:Array.prototype.slice.call(arguments,0)]),t},getNode:function(){return"object"==typeof arguments[0]?l.getNodeByElement(arguments[0]):l.getNodes(arguments[0],arguments[1],!0)},getNodes:function(t,e){return l.getNodes(t,e,!1)},destroy:function(){var t=[],e=arguments[0];return Array.isArray(e)&&(t=e),"string"==typeof e?t=l.getNodes(e,arguments[1]):e instanceof k?t.push(e):e.nodeName&&(t=l.getNodes().filter(function(t){return o(e,t.getElement())})),0===t.length?!1:l.destroy(t)},getModule:function(){var t,e,i,n,o,r,s,a;if("object"==typeof arguments[0])return s=l.getNodeByElement(arguments[0]),s?s.getModule(arguments[1]):null;for(e=arguments[0],"string"==typeof arguments[1]?(i=arguments[1],n=arguments[2]):n=arguments[1],t=0,o=l.getNodes(i,n,!1),r=o.length;r>t;t++)if(a=o[t].getModule(e))return a;return null},getModules:function(){var t,e,i,n,o,r,s,a,u;if("object"==typeof arguments[0])return s=l.getNodeByElement(arguments[0]),s.getModules(arguments[1]);for(e=arguments[0],"string"==typeof arguments[1]?(i=arguments[1],n=arguments[2]):n=arguments[1],t=0,o=this.getNodes(i,n),r=o.length,u=[];r>t;t++)a=o[t].getModules(e),a.length&&(u=u.concat(a));return u},is:function(t,e){this.matchesCondition(t,e)},on:function(t,e,i){return this.addConditionMonitor(t,e,i)},matchesCondition:function(t,e){var i=new n,o=f.setTest(t,e,function(t){i.resolve(t),f.clearTest(o)});return i},addConditionMonitor:function(t,e,i){return i="function"==typeof e?e:i,f.setTest(t,e,function(t){i(t)})},removeConditionMonitor:function(t){f.clearTest(t)}}};"undefined"!=typeof module&&module.exports?module.exports=i(require,require("./utils/Observer"),require("./utils/Promise"),require("./utils/contains"),require("./utils/matchesSelector"),require("./utils/mergeObjects")):"function"==typeof define&&define.amd&&define("conditioner",["require","./utils/Observer","./utils/Promise","./utils/contains","./utils/matchesSelector","./utils/mergeObjects"],i)}(this),require.config({map:{"*":{slim:"slim.amd.min"}}}),require(["conditioner"],function(t){t.init()}),define("main",function(){}),function(t,e){"use strict";var i=function(e){var i=t.innerHeight,n=e.getBoundingClientRect();return n.top>0&&n.top<i||n.bottom>0&&n.bottom<i},n=function(t){return parseInt(t,10)},o={trigger:{resize:t,scroll:t},test:{visible:function(t){return t.seen=i(t.element),t.seen&&t.expected},"min-width":function(t){return n(t.expected)<=t.element.offsetWidth},"max-width":function(t){return n(t.expected)>=t.element.offsetWidth},"min-height":function(t){return n(t.expected)<=t.element.offsetHeight},"max-height":function(t){return n(t.expected)>=t.element.offsetHeight}}};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd&&define("monitors/element",[],function(){return o})}(this),function(t,e){"use strict";var i={data:{mql:null},trigger:function(e,i){"supported"!==i.expected&&(i.change=function(){e()},i.mql=t.matchMedia(i.expected),i.mql.addListener(i.change))},parse:function(t){var e=[];return"supported"===t?e.push({test:"supported",value:!0}):e.push({test:"query",value:t}),e},test:{supported:function(){return"matchMedia"in t},query:function(t){return t.mql.matches}},unload:function(t){t.mql.removeListener(t.change)}};"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd&&define("monitors/media",[],function(){return i})}(this),define("slim.amd.min",[],function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return L[t]||"unknown"}function i(t,e){if(!(e>=1)){for(var i,n=G(t),o=t.width,r=t.height,s=Math.ceil(t.width*e),a=Math.ceil(t.height*e);o>s&&(o*=.5,r*=.5,!(s>o));)n=b("canvas"),n.width=o,n.height=r,i=n.getContext("2d"),i.drawImage(t,0,0,o,r);t.width=s,t.height=a,i=t.getContext("2d"),i.drawImage(n,0,0,s,a)}}function n(t){return t.width&&t.height}function o(t,e,i,n){var o=(n-90)*Math.PI/180;return{x:t+i*Math.cos(o),y:e+i*Math.sin(o)}}function r(t,e,i,n,r){var s=o(t,e,i,r),a=o(t,e,i,n),u=180>=r-n?"0":"1",l=["M",s.x,s.y,"A",i,i,0,u,0,a.x,a.y].join(" ");return l}!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.CustomEvent.prototype,window.CustomEvent=t}();var s=function(t,e,i){var n,o,r=document.createElement("img");if(r.onerror=e,r.onload=function(){!o||i&&i.noRevoke||s.revokeObjectURL(o),e&&e(s.scale(r,i))},s.isInstanceOf("Blob",t)||s.isInstanceOf("File",t))n=o=s.createObjectURL(t),r._type=t.type;else{if("string"!=typeof t)return!1;n=t,i&&i.crossOrigin&&(r.crossOrigin=i.crossOrigin)}return n?(r.src=n,r):s.readFile(t,function(t){var i=t.target;i&&i.result?r.src=i.result:e&&e(t)})},a=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;s.isInstanceOf=function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},s.transformCoordinates=function(){},s.getTransformedOptions=function(t,e){var i,n,o,r,s=e.aspectRatio;if(!s)return e;i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i.crop=!0,o=t.naturalWidth||t.width,r=t.naturalHeight||t.height,o/r>s?(i.maxWidth=r*s,i.maxHeight=r):(i.maxWidth=o,i.maxHeight=o/s),i},s.renderImageToCanvas=function(t,e,i,n,o,r,s,a,u,l){return t.getContext("2d").drawImage(e,i,n,o,r,s,a,u,l),t},s.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},s.scale=function(t,e){function i(){var t=Math.max((a||w)/w,(u||b)/b);t>1&&(w*=t,b*=t)}function n(){var t=Math.min((o||w)/w,(r||b)/b);1>t&&(w*=t,b*=t)}e=e||{};var o,r,a,u,l,h,c,d,p,f,m,g=document.createElement("canvas"),_=t.getContext||s.hasCanvasOption(e)&&g.getContext,v=t.naturalWidth||t.width,y=t.naturalHeight||t.height,w=v,b=y;if(_&&(e=s.getTransformedOptions(t,e),c=e.left||0,d=e.top||0,e.sourceWidth?(l=e.sourceWidth,void 0!==e.right&&void 0===e.left&&(c=v-l-e.right)):l=v-c-(e.right||0),e.sourceHeight?(h=e.sourceHeight,void 0!==e.bottom&&void 0===e.top&&(d=y-h-e.bottom)):h=y-d-(e.bottom||0),w=l,b=h),o=e.maxWidth,r=e.maxHeight,a=e.minWidth,u=e.minHeight,_&&o&&r&&e.crop?(w=o,b=r,m=l/h-o/r,0>m?(h=r*l/o,void 0===e.top&&void 0===e.bottom&&(d=(y-h)/2)):m>0&&(l=o*h/r,void 0===e.left&&void 0===e.right&&(c=(v-l)/2))):((e.contain||e.cover)&&(a=o=o||a,u=r=r||u),e.cover?(n(),i()):(i(),n())),_){if(p=e.pixelRatio,p>1&&(g.style.width=w+"px",g.style.height=b+"px",w*=p,b*=p,g.getContext("2d").scale(p,p)),f=e.downsamplingRatio,f>0&&1>f&&l>w&&h>b)for(;l*f>w;)g.width=l*f,g.height=h*f,s.renderImageToCanvas(g,t,c,d,l,h,0,0,g.width,g.height),l=g.width,h=g.height,t=document.createElement("canvas"),t.width=l,t.height=h,s.renderImageToCanvas(t,g,0,0,l,h,0,0,l,h);return g.width=w,g.height=b,s.transformCoordinates(g,e),s.renderImageToCanvas(g,t,c,d,l,h,0,0,w,b)}return t.width=w,t.height=b,t},s.createObjectURL=function(t){return!!a&&a.createObjectURL(t)},s.revokeObjectURL=function(t){return!!a&&a.revokeObjectURL(t)},s.readFile=function(t,e,i){if(window.FileReader){var n=new FileReader;if(n.onload=n.onerror=e,i=i||"readAsDataURL",n[i])return n[i](t),n}return!1};var u=s.hasCanvasOption,l=s.transformCoordinates,h=s.getTransformedOptions;s.hasCanvasOption=function(t){return!!t.orientation||u.call(s,t)},s.transformCoordinates=function(t,e){l.call(s,t,e);var i=t.getContext("2d"),n=t.width,o=t.height,r=t.style.width,a=t.style.height,u=e.orientation;if(u&&!(u>8))switch(u>4&&(t.width=o,t.height=n,t.style.width=a,t.style.height=r),u){case 2:i.translate(n,0),i.scale(-1,1);break;case 3:i.translate(n,o),i.rotate(Math.PI);break;case 4:i.translate(0,o),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-o);break;case 7:i.rotate(.5*Math.PI),i.translate(n,-o),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-n,0)}},s.getTransformedOptions=function(t,e){var i,n,o=h.call(s,t,e),r=o.orientation;if(!r||r>8||1===r)return o;i={};for(n in o)o.hasOwnProperty(n)&&(i[n]=o[n]);switch(o.orientation){case 2:i.left=o.right,i.right=o.left;break;case 3:i.left=o.right,i.top=o.bottom,i.right=o.left,i.bottom=o.top;break;case 4:i.top=o.bottom,i.bottom=o.top;break;case 5:i.left=o.top,i.top=o.left,i.right=o.bottom,i.bottom=o.right;break;case 6:i.left=o.top,i.top=o.right,i.right=o.bottom,i.bottom=o.left;break;case 7:i.left=o.bottom,i.top=o.right,i.right=o.top,i.bottom=o.left;break;case 8:i.left=o.bottom,i.top=o.left,i.right=o.top,i.bottom=o.right}return o.orientation>4&&(i.maxWidth=o.maxHeight,i.maxHeight=o.maxWidth,i.minWidth=o.minHeight,i.minHeight=o.minWidth,i.sourceWidth=o.sourceHeight,i.sourceHeight=o.sourceWidth),i};var c=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);s.blobSlice=c&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},s.metaDataParsers={jpeg:{65505:[]}},s.parseMetaData=function(t,e,i){i=i||{};var n=this,o=i.maxMetaDataSize||262144,r={},a=!(window.DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&s.blobSlice);!a&&s.readFile(s.blobSlice.call(t,0,o),function(t){if(t.target.error)return console.log(t.target.error),void e(r);var o,a,u,l,h=t.target.result,c=new DataView(h),d=2,p=c.byteLength-4,f=d;if(65496===c.getUint16(0)){for(;p>d&&(o=c.getUint16(d),o>=65504&&65519>=o||65534===o);){if(a=c.getUint16(d+2)+2,d+a>c.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(u=s.metaDataParsers.jpeg[o])for(l=0;l<u.length;l+=1)u[l].call(n,c,d,a,r,i);d+=a,f=d}!i.disableImageHead&&f>6&&(h.slice?r.imageHead=h.slice(0,f):r.imageHead=new Uint8Array(h).subarray(0,f))}else console.log("Invalid JPEG file: Missing JPEG marker.");e(r)},"readAsArrayBuffer")||e(r)},s.ExifMap=function(){return this},s.ExifMap.prototype.map={Orientation:274},s.ExifMap.prototype.get=function(t){return this[t]||this[this.map[t]]},s.getExifThumbnail=function(t,e,i){var n,o,r;if(!i||e+i>t.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(n=[],o=0;i>o;o+=1)r=t.getUint8(e+o),n.push((16>r?"0":"")+r.toString(16));return"data:image/jpeg,%"+n.join("%")},s.exifTagTypes={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,i){return t.getUint16(e,i)},size:2},4:{getValue:function(t,e,i){return t.getUint32(e,i)},size:4},5:{getValue:function(t,e,i){return t.getUint32(e,i)/t.getUint32(e+4,i)},size:8},9:{getValue:function(t,e,i){return t.getInt32(e,i)},size:4},10:{getValue:function(t,e,i){return t.getInt32(e,i)/t.getInt32(e+4,i)},size:8}},s.exifTagTypes[7]=s.exifTagTypes[1],s.getExifValue=function(t,e,i,n,o,r){var a,u,l,h,c,d,p=s.exifTagTypes[n];if(!p)return void console.log("Invalid Exif data: Invalid tag type.");if(a=p.size*o,u=a>4?e+t.getUint32(i+8,r):i+8,u+a>t.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===o)return p.getValue(t,u,r);for(l=[],h=0;o>h;h+=1)l[h]=p.getValue(t,u+h*p.size,r);if(p.ascii){for(c="",h=0;h<l.length&&(d=l[h],"\x00"!==d);h+=1)c+=d;return c}return l},s.parseExifTag=function(t,e,i,n,o){var r=t.getUint16(i,n);o.exif[r]=s.getExifValue(t,e,i,t.getUint16(i+2,n),t.getUint32(i+4,n),n)},s.parseExifTags=function(t,e,i,n,o){var r,s,a;if(i+6>t.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(r=t.getUint16(i,n),s=i+2+12*r,s+4>t.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(a=0;r>a;a+=1)this.parseExifTag(t,e,i+2+12*a,n,o);return t.getUint32(s,n)},s.parseExifData=function(t,e,i,n,o){if(!o.disableExif){var r,a,u,l=e+10;if(1165519206===t.getUint32(e+4)){if(l+8>t.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==t.getUint16(e+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(t.getUint16(l)){case 18761:r=!0;break;case 19789:r=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==t.getUint16(l+2,r))return void console.log("Invalid Exif data: Missing TIFF marker.");a=t.getUint32(l+4,r),n.exif=new s.ExifMap,a=s.parseExifTags(t,l,l+a,r,n),a&&!o.disableExifThumbnail&&(u={exif:{}},a=s.parseExifTags(t,l,l+a,r,u),u.exif[513]&&(n.exif.Thumbnail=s.getExifThumbnail(t,l+u.exif[513],u.exif[514]))),
n.exif[34665]&&!o.disableExifSub&&s.parseExifTags(t,l,l+n.exif[34665],r,n),n.exif[34853]&&!o.disableExifGps&&s.parseExifTags(t,l,l+n.exif[34853],r,n)}}},s.metaDataParsers.jpeg[65505].push(s.parseExifData);var d=function(){var t=[],e=[],i=[],n="transform",o=window.getComputedStyle(document.documentElement,""),r=(Array.prototype.slice.call(o).join("").match(/-(moz|webkit|ms)-/)||""===o.OLink&&["","o"])[1];"webkit"===r&&(n="webkitTransform");var s=function(t,e,i){var n=t;if(void 0!==n.length){for(var o={chainers:[],then:function(t){return this.snabbt(t)},snabbt:function(t){var e=this.chainers.length;return this.chainers.forEach(function(i,n){i.snabbt(a(t,n,e))}),o},setValue:function(t){return this.chainers.forEach(function(e){e.setValue(t)}),o},finish:function(){return this.chainers.forEach(function(t){t.finish()}),o},rollback:function(){return this.chainers.forEach(function(t){t.rollback()}),o}},r=0,s=n.length;s>r;++r)"string"==typeof e?o.chainers.push(u(n[r],e,a(i,r,s))):o.chainers.push(u(n[r],a(e,r,s),i));return o}return"string"==typeof e?u(n,e,a(i,0,1)):u(n,a(e,0,1),i)},a=function(t,e,i){if(!t)return t;var n=G(t);V(t.delay)&&(n.delay=t.delay(e,i)),V(t.callback)&&(n.complete=function(){t.callback.call(this,e,i)});var o=V(t.allDone),r=V(t.complete);(r||o)&&(n.complete=function(){r&&t.complete.call(this,e,i),o&&e==i-1&&t.allDone()}),V(t.valueFeeder)&&(n.valueFeeder=function(n,o){return t.valueFeeder(n,o,e,i)}),V(t.easing)&&(n.easing=function(n){return t.easing(n,e,i)});var s=["position","rotation","skew","rotationPost","scale","width","height","opacity","fromPosition","fromRotation","fromSkew","fromRotationPost","fromScale","fromWidth","fromHeight","fromOpacity","transformOrigin","duration","delay"];return s.forEach(function(o){V(t[o])&&(n[o]=t[o](e,i))}),n},u=function(t,i,n){function o(i){return _.tick(i),_.updateElement(t),_.isStopped()?void 0:_.completed()?void(r.loop>1&&!_.isStopped()?(r.loop-=1,_.restart(),v(o)):(r.complete&&r.complete.call(t),y.length&&(r=y.pop(),u=m(r,c,!0),c=m(r,G(c)),r=g(u,c,r),_=w(r),e.push([t,_]),_.tick(i),v(o)))):v(o)}if("attention"===i)return l(t,n);if("stop"===i)return h(t);var r=i;d();var s=f(t),u=s;u=m(r,u,!0);var c=G(s);c=m(r,c);var p=g(u,c,r),_=w(p);e.push([t,_]),_.updateElement(t,!0);var y=[],b={snabbt:function(t){return y.unshift(a(t,0,1)),b},then:function(t){return this.snabbt(t)}};return v(o),r.manual?_:b},l=function(t,i){function n(e){r.tick(e),r.updateElement(t),r.completed()?(i.callback&&i.callback(t),i.loop&&i.loop>1&&(i.loop--,r.restart(),v(n))):v(n)}var o=m(i,R({}));i.movement=o;var r=b(i);e.push([t,r]),v(n)},h=function(t){for(var i=0,n=e.length;n>i;++i){var o=e[i],r=o[0],s=o[1];r===t&&s.stop()}},c=function(t,e){for(var i=0,n=t.length;n>i;++i){var o=t[i],r=o[0],s=o[1];if(r===e){var a=s.getCurrentState();return s.stop(),a}}},d=function(){i=i.filter(function(t){return p(t[0]).body})},p=function(t){for(var e=t;e.parentNode;)e=e.parentNode;return e},f=function(t){var n=c(e,t);return n?n:c(i,t)},m=function(t,e,i){e||(e=R({position:[0,0,0],rotation:[0,0,0],rotationPost:[0,0,0],scale:[1,1],skew:[0,0]}));var n="position",o="rotation",r="skew",s="rotationPost",a="scale",u="scalePost",l="width",h="height",c="opacity";return i&&(n="fromPosition",o="fromRotation",r="fromSkew",s="fromRotationPost",a="fromScale",u="fromScalePost",l="fromWidth",h="fromHeight",c="fromOpacity"),e.position=H(t[n],e.position),e.rotation=H(t[o],e.rotation),e.rotationPost=H(t[s],e.rotationPost),e.skew=H(t[r],e.skew),e.scale=H(t[a],e.scale),e.scalePost=H(t[u],e.scalePost),e.opacity=t[c],e.width=t[l],e.height=t[h],e},g=function(t,e,i){return i.startState=t,i.endState=e,i},_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},v=function(e){0===t.length&&_(y),t.push(e)},y=function(n){for(var o=t.length,r=0;o>r;++r)t[r](n);t.splice(0,o);var s=e.filter(function(t){return t[1].completed()});i=i.filter(function(t){for(var e=0,i=s.length;i>e;++e)if(t[0]===s[e][0])return!1;return!0}),i=i.concat(s),e=e.filter(function(t){return!t[1].completed()}),0!==t.length&&_(y)},w=function(t){var e=t.startState,i=t.endState,n=H(t.duration,500),o=H(t.delay,0),r=t.perspective,s=P(H(t.easing,"linear"),t),a=0===n?i.clone():e.clone();t.transformOrigin,a.transformOrigin=t.transformOrigin;var u,l,h=0,c=0,d=!1,p=!1,f=t.manual,m=0,g=o/n;return l=t.valueFeeder?q(t.valueFeeder,e,i,a):F(e,i,a),{stop:function(){d=!0},isStopped:function(){return d},finish:function(t){f=!1;var e=n*m;h=c-e,u=t,s.resetFrom=m},rollback:function(t){f=!1,l.setReverse();var e=n*(1-m);h=c-e,u=t,s.resetFrom=m},restart:function(){h=void 0,s.resetFrom(0)},tick:function(t){if(!d){if(f)return c=t,void this.updateCurrentTransform();if(h||(h=t),t-h>o){p=!0,c=t-o;var e=Math.min(Math.max(0,c-h),n);s.tick(e/n),this.updateCurrentTransform(),this.completed()&&u&&u()}}},getCurrentState:function(){return a},setValue:function(t){p=!0,m=Math.min(Math.max(t,1e-4),1+g)},updateCurrentTransform:function(){var t=s.getValue();if(f){var e=Math.max(1e-5,m-g);s.tick(e),t=s.getValue()}l.tween(t)},completed:function(){return!!d||0!==h&&s.completed()},updateElement:function(t,e){if(p||e){var i=l.asMatrix(),n=l.getProperties();j(t,i,r),W(t,n)}}}},b=function(t){var e=t.movement;t.initialVelocity=.1,t.equilibriumPosition=0;var i=S(t),n=!1,o=e.position,r=e.rotation,s=e.rotationPost,a=e.scale,u=e.skew,l=R({position:o?[0,0,0]:void 0,rotation:r?[0,0,0]:void 0,rotationPost:s?[0,0,0]:void 0,scale:a?[0,0]:void 0,skew:u?[0,0]:void 0});return{stop:function(){n=!0},isStopped:function(t){return n},tick:function(t){n||i.equilibrium||(i.tick(),this.updateMovement())},updateMovement:function(){var t=i.getValue();o&&(l.position[0]=e.position[0]*t,l.position[1]=e.position[1]*t,l.position[2]=e.position[2]*t),r&&(l.rotation[0]=e.rotation[0]*t,l.rotation[1]=e.rotation[1]*t,l.rotation[2]=e.rotation[2]*t),s&&(l.rotationPost[0]=e.rotationPost[0]*t,l.rotationPost[1]=e.rotationPost[1]*t,l.rotationPost[2]=e.rotationPost[2]*t),a&&(l.scale[0]=1+e.scale[0]*t,l.scale[1]=1+e.scale[1]*t),u&&(l.skew[0]=e.skew[0]*t,l.skew[1]=e.skew[1]*t)},updateElement:function(t){j(t,l.asMatrix()),W(t,l.getProperties())},getCurrentState:function(){return l},completed:function(){return i.equilibrium||n},restart:function(){i=S(t)}}},k=function(t){return t},x=function(t){return(Math.cos(t*Math.PI+Math.PI)+1)/2},E=function(t){return t*t},C=function(t){return-Math.pow(t-1,2)+1},S=function(t){var e=H(t.startPosition,0),i=H(t.equilibriumPosition,1),n=H(t.initialVelocity,0),o=H(t.springConstant,.8),r=H(t.springDeceleration,.9),s=H(t.springMass,10),a=!1;return{tick:function(t){if(0!==t&&!a){var u=-(e-i)*o,l=u/s;n+=l,e+=n,n*=r,Math.abs(e-i)<.001&&Math.abs(n)<.001&&(a=!0)}},resetFrom:function(t){e=t,n=0},getValue:function(){return a?i:e},completed:function(){return a}}},M={linear:k,ease:x,easeIn:E,easeOut:C},P=function(t,e){if("spring"==t)return S(e);var i=t;V(t)||(i=M[t]);var n,o=i,r=0;return{tick:function(t){r=o(t),n=t},resetFrom:function(t){n=0},getValue:function(){return r},completed:function(){return n>=1&&n}}},A=function(t,e,i,n){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e,t[13]=i,t[14]=n,t[15]=1},O=function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=Math.cos(e),t[6]=-Math.sin(e),t[7]=0,t[8]=0,t[9]=Math.sin(e),t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},T=function(t,e){t[0]=Math.cos(e),t[1]=0,t[2]=Math.sin(e),t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=-Math.sin(e),t[9]=0,t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},I=function(t,e){t[0]=Math.cos(e),t[1]=-Math.sin(e),t[2]=0,t[3]=0,t[4]=Math.sin(e),t[5]=Math.cos(e),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},L=function(t,e,i){t[0]=1,t[1]=Math.tan(e),t[2]=0,t[3]=0,t[4]=Math.tan(i),t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},D=function(t,e,i){t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},B=function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1},U=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]},z=function(){var t=new Float32Array(16),e=new Float32Array(16),i=new Float32Array(16);return B(t),{data:t,asCSS:function(){for(var e="matrix3d(",i=0;15>i;++i)e+=Math.abs(t[i])<1e-4?"0,":t[i].toFixed(10)+",";return e+=Math.abs(t[15])<1e-4?"0)":t[15].toFixed(10)+")"},clear:function(){B(t)},translate:function(n,o,r){return U(t,e),A(i,n,o,r),N(e,i,t),this},rotateX:function(n){return U(t,e),O(i,n),N(e,i,t),this},rotateY:function(n){return U(t,e),T(i,n),N(e,i,t),this},rotateZ:function(n){return U(t,e),I(i,n),N(e,i,t),this},scale:function(n,o){return U(t,e),D(i,n,o),N(e,i,t),this},skew:function(n,o){return U(t,e),L(i,n,o),N(e,i,t),this}}},N=function(t,e,i){return i[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],i[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],i[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],i[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],i[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],i[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],i[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],i[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],i[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],i[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],i[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],i[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],i[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],i[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],i[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],i[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],i},R=function(t){var e=z(),i={opacity:void 0,width:void 0,height:void 0};return{position:t.position,rotation:t.rotation,rotationPost:t.rotationPost,skew:t.skew,scale:t.scale,scalePost:t.scalePost,opacity:t.opacity,width:t.width,height:t.height,clone:function(){return R({position:this.position?this.position.slice(0):void 0,rotation:this.rotation?this.rotation.slice(0):void 0,rotationPost:this.rotationPost?this.rotationPost.slice(0):void 0,skew:this.skew?this.skew.slice(0):void 0,scale:this.scale?this.scale.slice(0):void 0,scalePost:this.scalePost?this.scalePost.slice(0):void 0,height:this.height,width:this.width,opacity:this.opacity})},asMatrix:function(){var t=e;return t.clear(),this.transformOrigin&&t.translate(-this.transformOrigin[0],-this.transformOrigin[1],-this.transformOrigin[2]),this.scale&&t.scale(this.scale[0],this.scale[1]),this.skew&&t.skew(this.skew[0],this.skew[1]),this.rotation&&(t.rotateX(this.rotation[0]),t.rotateY(this.rotation[1]),t.rotateZ(this.rotation[2])),this.position&&t.translate(this.position[0],this.position[1],this.position[2]),this.rotationPost&&(t.rotateX(this.rotationPost[0]),t.rotateY(this.rotationPost[1]),t.rotateZ(this.rotationPost[2])),this.scalePost&&t.scale(this.scalePost[0],this.scalePost[1]),this.transformOrigin&&t.translate(this.transformOrigin[0],this.transformOrigin[1],this.transformOrigin[2]),t},getProperties:function(){return i.opacity=this.opacity,i.width=this.width+"px",i.height=this.height+"px",i}}},F=function(t,e,i){var n=t,o=e,r=i,s=void 0!==o.position,a=void 0!==o.rotation,u=void 0!==o.rotationPost,l=void 0!==o.scale,h=void 0!==o.skew,c=void 0!==o.width,d=void 0!==o.height,p=void 0!==o.opacity;return{tween:function(t){if(s){var e=o.position[0]-n.position[0],i=o.position[1]-n.position[1],f=o.position[2]-n.position[2];r.position[0]=n.position[0]+t*e,r.position[1]=n.position[1]+t*i,r.position[2]=n.position[2]+t*f}if(a){var m=o.rotation[0]-n.rotation[0],g=o.rotation[1]-n.rotation[1],_=o.rotation[2]-n.rotation[2];r.rotation[0]=n.rotation[0]+t*m,r.rotation[1]=n.rotation[1]+t*g,r.rotation[2]=n.rotation[2]+t*_}if(u){var v=o.rotationPost[0]-n.rotationPost[0],y=o.rotationPost[1]-n.rotationPost[1],w=o.rotationPost[2]-n.rotationPost[2];r.rotationPost[0]=n.rotationPost[0]+t*v,r.rotationPost[1]=n.rotationPost[1]+t*y,r.rotationPost[2]=n.rotationPost[2]+t*w}if(h){var b=o.scale[0]-n.scale[0],k=o.scale[1]-n.scale[1];r.scale[0]=n.scale[0]+t*b,r.scale[1]=n.scale[1]+t*k}if(l){var x=o.skew[0]-n.skew[0],E=o.skew[1]-n.skew[1];r.skew[0]=n.skew[0]+t*x,r.skew[1]=n.skew[1]+t*E}if(c){var C=o.width-n.width;r.width=n.width+t*C}if(d){var S=o.height-n.height;r.height=n.height+t*S}if(p){var M=o.opacity-n.opacity;r.opacity=n.opacity+t*M}},asMatrix:function(){return r.asMatrix()},getProperties:function(){return r.getProperties()},setReverse:function(){var t=n;n=o,o=t}}},q=function(t,e,i,n){var o=t(0,z()),r=e,s=i,a=n,u=!1;return{tween:function(e){u&&(e=1-e),o.clear(),o=t(e,o);var i=s.width-r.width,n=s.height-r.height,l=s.opacity-r.opacity;void 0!==s.width&&(a.width=r.width+e*i),void 0!==s.height&&(a.height=r.height+e*n),void 0!==s.opacity&&(a.opacity=r.opacity+e*l)},asMatrix:function(){return o},getProperties:function(){return a.getProperties()},setReverse:function(){u=!0}}},H=function(t,e){return"undefined"==typeof t?e:t},j=function(t,e,i){var o="";i&&(o="perspective("+i+"px) ");var r=e.asCSS();t.style[n]=o+r},W=function(t,e){for(var i in e)t.style[i]=e[i]},V=function(t){return"function"==typeof t},G=function(t){if(!t)return t;var e={};for(var i in t)e[i]=t[i];return e};return s.createMatrix=z,s.setElementTransform=j,s}(),p=function(){function t(t,e,i,n,o){if("string"==typeof t)t=document.getElementById(t);else if(!t instanceof HTMLCanvasElement)return;var r,s=t.getContext("2d");try{try{r=s.getImageData(e,i,n,o)}catch(a){throw new Error("unable to access local image data: "+a)}}catch(a){throw new Error("unable to access image data: "+a)}return r}function e(e,n,o,r,s,a){if(!(isNaN(a)||1>a)){a|=0;var u=t(e,n,o,r,s);u=i(u,n,o,r,s,a),e.getContext("2d").putImageData(u,n,o)}}function i(t,e,i,s,a,u){var l,h,c,d,p,f,m,g,_,v,y,w,b,k,x,E,C,S,M,P,A,O,T,I,L=t.data,D=u+u+1,B=s-1,U=a-1,z=u+1,N=z*(z+1)/2,R=new n,F=R;for(c=1;D>c;c++)if(F=F.next=new n,c==z)var q=F;F.next=R;var H=null,j=null;m=f=0;var W=o[u],V=r[u];for(h=0;a>h;h++){for(E=C=S=M=g=_=v=y=0,w=z*(P=L[f]),b=z*(A=L[f+1]),k=z*(O=L[f+2]),x=z*(T=L[f+3]),g+=N*P,_+=N*A,v+=N*O,y+=N*T,F=R,c=0;z>c;c++)F.r=P,F.g=A,F.b=O,F.a=T,F=F.next;for(c=1;z>c;c++)d=f+((c>B?B:c)<<2),g+=(F.r=P=L[d])*(I=z-c),_+=(F.g=A=L[d+1])*I,v+=(F.b=O=L[d+2])*I,y+=(F.a=T=L[d+3])*I,E+=P,C+=A,S+=O,M+=T,F=F.next;for(H=R,j=q,l=0;s>l;l++)L[f+3]=T=y*W>>V,0!=T?(T=255/T,L[f]=(g*W>>V)*T,L[f+1]=(_*W>>V)*T,L[f+2]=(v*W>>V)*T):L[f]=L[f+1]=L[f+2]=0,g-=w,_-=b,v-=k,y-=x,w-=H.r,b-=H.g,k-=H.b,x-=H.a,d=m+((d=l+u+1)<B?d:B)<<2,E+=H.r=L[d],C+=H.g=L[d+1],S+=H.b=L[d+2],M+=H.a=L[d+3],g+=E,_+=C,v+=S,y+=M,H=H.next,w+=P=j.r,b+=A=j.g,k+=O=j.b,x+=T=j.a,E-=P,C-=A,S-=O,M-=T,j=j.next,f+=4;m+=s}for(l=0;s>l;l++){for(C=S=M=E=_=v=y=g=0,f=l<<2,w=z*(P=L[f]),b=z*(A=L[f+1]),k=z*(O=L[f+2]),x=z*(T=L[f+3]),g+=N*P,_+=N*A,v+=N*O,y+=N*T,F=R,c=0;z>c;c++)F.r=P,F.g=A,F.b=O,F.a=T,F=F.next;for(p=s,c=1;u>=c;c++)f=p+l<<2,g+=(F.r=P=L[f])*(I=z-c),_+=(F.g=A=L[f+1])*I,v+=(F.b=O=L[f+2])*I,y+=(F.a=T=L[f+3])*I,E+=P,C+=A,S+=O,M+=T,F=F.next,U>c&&(p+=s);for(f=l,H=R,j=q,h=0;a>h;h++)d=f<<2,L[d+3]=T=y*W>>V,T>0?(T=255/T,L[d]=(g*W>>V)*T,L[d+1]=(_*W>>V)*T,L[d+2]=(v*W>>V)*T):L[d]=L[d+1]=L[d+2]=0,g-=w,_-=b,v-=k,y-=x,w-=H.r,b-=H.g,k-=H.b,x-=H.a,d=l+((d=h+z)<U?d:U)*s<<2,g+=E+=H.r=L[d],_+=C+=H.g=L[d+1],v+=S+=H.b=L[d+2],y+=M+=H.a=L[d+3],H=H.next,w+=P=j.r,b+=A=j.g,k+=O=j.b,x+=T=j.a,E-=P,C-=A,S-=O,M-=T,j=j.next,f+=s}return t}function n(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var o=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return e}();HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),o=n.length,r=new Uint8Array(o),s=0;o>s;s++)r[s]=n.charCodeAt(s);t(new Blob([r],{type:e||"image/png"}))}});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},m=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),g=function(t){return Array.prototype.slice.call(t.attributes).map(function(t){return{name:t.name,value:t.value}})},_=function(t){return{x:"undefined"==typeof t.offsetX?t.layerX:t.offsetX,y:"undefined"==typeof t.offsetY?t.layerY:t.offsetY}},v=function(t,e){var i,n={},o=e||{};for(i in t)t.hasOwnProperty(i)&&(n[i]="undefined"==typeof o[i]?t[i]:o[i]);return n},y={ESC:27,RETURN:13},w={DOWN:["touchstart","pointerdown","mousedown"],MOVE:["touchmove","pointermove","mousemove"],UP:["touchend","touchcancel","pointerup","mouseup"]},b=function(t,e){var i=document.createElement(t);return e&&(i.className=e),i},k=function(t,e,i){e.forEach(function(e){t.addEventListener(e,i,!1)})},x=function(t,e,i){e.forEach(function(e){t.removeEventListener(e,i,!1)})},E=function(t){var e=t.changedTouches?t.changedTouches[0]:t;return e?{x:e.pageX,y:e.pageY}:void 0},C=function(t,e){var i=E(t),n=e.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft;return{x:i.x-n.left-r,y:i.y-n.top-o}},S=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},M=function(t){return t[t.length-1]},P=function(t,e,i){return Math.max(e,Math.min(i,t))},A=function(t,e){return-1!==e.indexOf(t)},O=function(t,e,i,n,o){var r=new XMLHttpRequest;i&&r.upload.addEventListener("progress",function(t){i(t.loaded,t.total)}),r.open("POST",t,!0),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var t=r.responseText;if(!t.length)return void n();if(-1!==t.indexOf("Content-Length"))return void o("file-too-big");var e=null;try{e=JSON.parse(r.responseText)}catch(i){}n(e||t)}else 4===r.readyState&&o("fail")},r.send(e)},T=function(t){t.style.transform=""},I=function(t){return t/1e6},L={jpeg:"image/jpeg",jpg:"image/jpeg",jpe:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp"},D=function(){var t=[],e=void 0,i=void 0;for(e in L)L.hasOwnProperty(e)&&(i=L[e],-1==t.indexOf(i)&&t.push(i));return t},B=function(t){return"image/jpeg"===t},U=function(t){var e=void 0;for(e in L)if(L.hasOwnProperty(e)&&L[e]===t)return e;return t},z=function(t){return t.split("/").pop().split("?").shift()},N=function(t){if("string"!=typeof t)return"unknown";var e=z(t);return e.split(".").shift()},R=function(t){var e=rt(t),i=U(e),n="unknown."+i;return{name:n,type:e,size:Math.floor(.73*t.length)}},F=function(t){var i=z(t),n=e(i.split(".").pop());return{name:i,type:n,size:null}},q=function(t){return{name:t.name,type:t.type,size:t.size}},H=function(t){return"string"==typeof t?/^data:image/.test(t)?R(t):F(t):q(t)},j=function(t,e){s.parseMetaData(t,function(i){var n={canvas:!0,crossOrigin:!0};i.exif&&(n.orientation=i.exif.get("Orientation")),s(t,function(t){return"error"===t.type?void e():void e(t,i)},n)})},W=function(t,e,i){var n,o,r,s,a=e/t;return i>a?(s=e,r=s/i,n=.5*(t-r),o=0):(r=t,s=r*i,n=0,o=.5*(e-s)),{x:n,y:o,height:s,width:r}},V=function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],o=b("canvas"),r={width:t.width,height:t.height},s=e.crop,a=e.size;if(s){o.width=s.width,o.height=s.height,s=tt(s),s.y+s.height>r.height&&(s.y=Math.max(0,r.height-s.height)),s.x+s.width>r.width&&(s.x=Math.max(0,r.width-s.width));var u=o.getContext("2d");u.drawImage(t,s.x,s.y,s.width,s.height,0,0,s.width,s.height)}a&&i(o,Math.min(a.width/o.width,a.height/o.height)),n(o)},G=function(t){return J(t,1)},J=function(t,e){if(!t)return null;var n=document.createElement("canvas");n.setAttribute("data-file",t.getAttribute("data-file"));var o=n.getContext("2d");return n.width=t.width,n.height=t.height,o.drawImage(t,0,0),e>0&&1!=e&&i(n,e),n},X=function(t,e){var i=e.getContext("2d");n(e)?i.drawImage(t,0,0,e.width,e.height):(e.width=t.width,e.height=t.height,i.drawImage(t,0,0))},Y=function(t){var e=t.getContext("2d");e.clearRect(0,0,t.width,t.height)},$=function(t){p(t,0,0,t.width,t.height,3)},Z=function(t,e,i){t.toBlob(function(t){if("msSaveBlob"in window.navigator)return void window.navigator.msSaveBlob(t,e);var i=URL.createObjectURL(t),n=b("a");n.style.display="none",n.download=e,n.href=i,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),URL.revokeObjectURL(i)},0)},i)},K=function(t,e){return parseInt(t.width,10)>=e.width&&parseInt(t.height,10)>=e.height},Q=function(t,e){return{x:t.x*e,y:t.y*e,width:t.width*e,height:t.height*e}},tt=function(t){return{x:Math.floor(t.x),y:Math.floor(t.y),width:Math.floor(t.width),height:Math.floor(t.height)}},et=function(t){if(t&&""!==t.value){try{t.value=""}catch(e){}if(t.value){var i=document.createElement("form"),n=t.parentNode,o=t.nextSibling;i.appendChild(t),i.reset(),o?n.insertBefore(t,o):n.appendChild(t)}}},it=function(t){return t?JSON.parse(JSON.stringify(t)):t},nt=function(t){var e=G(t.input.image),i=G(t.output.image),n=it(t);return n.input.image=e,n.output.image=i,n},ot=function(t,e,i){return t&&e?t.toDataURL(e,B(e)&&"number"==typeof i?i/100:void 0):null},rt=function(t){if(!t)return null;var e=t.match(/^.+;/);return e.length?e[0].substring(5,e[0].length-1):null},st=function(t){var e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],i=arguments[2],n=null,o={server:it(t.server),meta:it(t.meta),input:{name:t.input.name,type:t.input.type,size:t.input.size,width:t.input.width,height:t.input.height},output:{width:t.output.width,height:t.output.height}};return A("input",e)&&(o.input.image=ot(t.input.image,t.input.type)),A("output",e)&&(o.output.image=ot(t.output.image,t.input.type,i)),A("actions",e)&&(o.actions=it(t.actions)),n=rt(o.output.image||o.input.image),"image/png"===n&&(o.input.name=N(o.input.name)+".png",o.input.type=n),o},at=function(t,e,i){var n=i.querySelector(t);n&&(n.style.display=e?"":"none")},ut=function(t){return Array.prototype.slice.call(t)},lt=function(t){t.parentNode.removeChild(t)},ht=function(t){var e=b("div");return t.parentNode&&(t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)),e.appendChild(t),e},ct=function(t,e,i,n){return r(t,e,i,0,360*n)},dt=function(){var e={n:function(t,e,i,n){var o,r,s,a,u,l,h,c;return s=t.y+t.height,o=P(e.y,0,s),s-o<i.min.height&&(o=s-i.min.height),u=n?(s-o)/n:t.width,u<i.min.width&&(u=i.min.width,o=s-u*n),h=.5*(u-t.width),a=t.x-h,r=t.x+t.width+h,(0>a||r>i.width)&&(c=Math.min(t.x,i.width-(t.x+t.width)),a=t.x-c,r=t.x+t.width+c,u=r-a,l=u*n,o=s-l),{x:a,y:o,width:r-a,height:s-o}},s:function(t,e,i,n){var o,r,s,a,u,l,h,c;return o=t.y,s=P(e.y,o,i.height),s-o<i.min.height&&(s=o+i.min.height),u=n?(s-o)/n:t.width,u<i.min.width&&(u=i.min.width,s=o+u*n),h=.5*(u-t.width),a=t.x-h,r=t.x+t.width+h,(0>a||r>i.width)&&(c=Math.min(t.x,i.width-(t.x+t.width)),a=t.x-c,r=t.x+t.width+c,u=r-a,l=u*n,s=o+l),{x:a,y:o,width:r-a,height:s-o}},e:function(t,e,i,n){var o,r,s,a,u,l,h,c;return a=t.x,r=P(e.x,a,i.width),r-a<i.min.width&&(r=a+i.min.width),l=n?(r-a)*n:t.height,l<i.min.height&&(l=i.min.height,r=a+l/n),h=.5*(l-t.height),o=t.y-h,s=t.y+t.height+h,(0>o||s>i.height)&&(c=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-c,s=t.y+t.height+c,l=s-o,u=l/n,r=a+u),{x:a,y:o,width:r-a,height:s-o}},w:function i(t,e,n,o){var r,s,a,u,i,l,h,c;return s=t.x+t.width,u=P(e.x,0,s),s-u<n.min.width&&(u=s-n.min.width),l=o?(s-u)*o:t.height,l<n.min.height&&(l=n.min.height,u=s-l/o),h=.5*(l-t.height),r=t.y-h,a=t.y+t.height+h,(0>r||a>n.height)&&(c=Math.min(t.y,n.height-(t.y+t.height)),r=t.y-c,a=t.y+t.height+c,l=a-r,i=l/o,u=s-i),{x:u,y:r,width:s-u,height:a-r}},ne:function(t,e,i,n){var o,r,s,a,u,l,h;return a=t.x,s=t.y+t.height,r=P(e.x,a,i.width),r-a<i.min.width&&(r=a+i.min.width),l=n?(r-a)*n:P(s-e.y,i.min.height,s),l<i.min.height&&(l=i.min.height,r=a+l/n),o=t.y-(l-t.height),(0>o||s>i.height)&&(h=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-h,l=s-o,u=l/n,r=a+u),{x:a,y:o,width:r-a,height:s-o}},se:function(t,e,i,n){var o,r,s,a,u,l,h;return a=t.x,o=t.y,r=P(e.x,a,i.width),r-a<i.min.width&&(r=a+i.min.width),l=n?(r-a)*n:P(e.y-t.y,i.min.height,i.height-o),l<i.min.height&&(l=i.min.height,r=a+l/n),s=t.y+t.height+(l-t.height),(0>o||s>i.height)&&(h=Math.min(t.y,i.height-(t.y+t.height)),s=t.y+t.height+h,l=s-o,u=l/n,r=a+u),{x:a,y:o,width:r-a,height:s-o}},sw:function(t,e,i,n){var o,r,s,a,u,l,h;return r=t.x+t.width,o=t.y,a=P(e.x,0,r),r-a<i.min.width&&(a=r-i.min.width),l=n?(r-a)*n:P(e.y-t.y,i.min.height,i.height-o),l<i.min.height&&(l=i.min.height,a=r-l/n),s=t.y+t.height+(l-t.height),(0>o||s>i.height)&&(h=Math.min(t.y,i.height-(t.y+t.height)),s=t.y+t.height+h,l=s-o,u=l/n,a=r-u),{x:a,y:o,width:r-a,height:s-o}},nw:function(t,e,i,n){var o,r,s,a,u,l,h;return r=t.x+t.width,s=t.y+t.height,a=P(e.x,0,r),r-a<i.min.width&&(a=r-i.min.width),l=n?(r-a)*n:P(s-e.y,i.min.height,s),l<i.min.height&&(l=i.min.height,a=r-l/n),o=t.y-(l-t.height),(0>o||s>i.height)&&(h=Math.min(t.y,i.height-(t.y+t.height)),o=t.y-h,l=s-o,u=l/n,a=r-u),{x:a,y:o,width:r-a,height:s-o}}};return function(){function i(){var e=arguments.length<=0||void 0===arguments[0]?document.createElement("div"):arguments[0];t(this,i),this._element=e,this._interaction=null,this._minWidth=0,this._minHeight=0,this._ratio=null,this._rect={x:0,y:0,width:0,height:0},this._space={width:0,height:0},this._rectChanged=!1,this._init()}return m(i,[{key:"_init",value:function(){this._element.className="slim-crop-area";var t=b("div","grid");this._element.appendChild(t);for(var i in e)if(e.hasOwnProperty(i)){var n=b("button",i);this._element.appendChild(n)}var o=b("button","c");this._element.appendChild(o),k(document,w.DOWN,this)}},{key:"reset",value:function(){this._interaction=null,this._rect={x:0,y:0,width:0,height:0},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"rescale",value:function(t){1!==t&&(this._interaction=null,this._rectChanged=!0,this._rect.x*=t,this._rect.y*=t,this._rect.width*=t,this._rect.height*=t,this._redraw(),this._element.dispatchEvent(new CustomEvent("change")))}},{key:"limit",value:function(t,e){this._space={width:t,height:e}}},{key:"resize",value:function(t,e,i,n){this._interaction=null,this._rect={x:t,y:e,width:P(i,0,this._space.width),height:P(n,0,this._space.height)},this._rectChanged=!0,this._redraw(),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"mousedown":this._onStartDrag(t);break;case"touchmove":case"pointermove":case"mousemove":this._onDrag(t);break;case"touchend":case"touchcancel":case"pointerup":case"mouseup":this._onStopDrag(t)}}},{key:"_onStartDrag",value:function(t){this._element.contains(t.target)&&(t.preventDefault(),k(document,w.MOVE,this),k(document,w.UP,this),this._interaction={type:t.target.className,offset:C(t,this._element)},this._element.setAttribute("data-dragging","true"),this._redraw())}},{key:"_onDrag",value:function(t){t.preventDefault();var i=C(t,this._element.parentNode),n=this._interaction.type;"c"===n?(this._rect.x=P(i.x-this._interaction.offset.x,0,this._space.width-this._rect.width),this._rect.y=P(i.y-this._interaction.offset.y,0,this._space.height-this._rect.height)):e[n]&&(this._rect=e[n](this._rect,i,{x:0,y:0,width:this._space.width,height:this._space.height,min:{width:this._minWidth,height:this._minHeight}},this._ratio)),this._rectChanged=!0,this._element.dispatchEvent(new CustomEvent("input"))}},{key:"_onStopDrag",value:function(t){t.preventDefault(),x(document,w.MOVE,this),x(document,w.UP,this),this._interaction=null,this._element.setAttribute("data-dragging","false"),this._element.dispatchEvent(new CustomEvent("change"))}},{key:"_redraw",value:function(){var t=this;this._rectChanged&&(this._element.style.cssText="\n					left:"+this._rect.x+"px;\n					top:"+this._rect.y+"px;\n					width:"+this._rect.width+"px;\n					height:"+this._rect.height+"px;\n				",this._rectChanged=!1),this._interaction&&requestAnimationFrame(function(){return t._redraw()})}},{key:"destroy",value:function(){this._interaction=!1,this._rectChanged=!1,x(document,w.DOWN,this),x(document,w.MOVE,this),x(document,w.UP,this),lt(this._element)}},{key:"element",get:function(){return this._element}},{key:"area",get:function(){return this._rect}},{key:"dirty",get:function(){return 0!==this._rect.x||0!==this._rect.y||0!==this._rect.width||0!==this._rect.height}},{key:"minWidth",set:function(t){this._minWidth=t}},{key:"minHeight",set:function(t){this._minHeight=t}},{key:"ratio",set:function(t){this._ratio=t}}]),i}()}(),pt=function(){var e=["input","change"],i=function(){function i(){var e=arguments.length<=0||void 0===arguments[0]?document.createElement("div"):arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,i),this._element=e,this._options=v(i.options(),n),this._ratio=null,this._output=null,this._input=null,this._preview=null,this._previewBlurred=null,this._blurredPreview=!1,this._cropper=null,this._previewWrapper=null,this._currentWindowSize={},this._btnGroup=null,this._dirty=!1,this._init()}return m(i,[{key:"_init",value:function(){var t=this;this._element.className="slim-image-editor",this._wrapper=b("div","slim-wrapper"),this._stage=b("div","slim-stage"),this._wrapper.appendChild(this._stage),this._cropper=new dt,e.forEach(function(e){t._cropper.element.addEventListener(e,t)}),this._stage.appendChild(this._cropper.element),this._previewWrapper=b("div","slim-image-editor-preview slim-crop-preview"),this._previewBlurred=b("canvas","slim-crop-blur"),this._previewWrapper.appendChild(this._previewBlurred),this._wrapper.appendChild(this._previewWrapper),this._preview=b("img","slim-crop"),this._previewWrapper.appendChild(this._preview),this._btnGroup=b("div","slim-btn-group"),i.Buttons.forEach(function(e){var i=S(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"],r=t._options["button"+i+"ClassName"],s=b("button","slim-image-editor-btn slim-btn-"+e+(r?" "+r:""));s.innerHTML=n,s.title=o||n,s.type="button",s.setAttribute("data-action",e),s.addEventListener("click",t),t._btnGroup.appendChild(s)}),this._element.appendChild(this._wrapper),
    this._element.appendChild(this._btnGroup)}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onGridChange(t);break;case"input":this._onGridInput(t);break;case"keydown":this._onKeyDown(t);break;case"resize":this._onResize(t)}}},{key:"_onKeyDown",value:function(t){switch(t.keyCode){case y.RETURN:this._confirm();break;case y.ESC:this._cancel()}}},{key:"_onClick",value:function(t){t.target.classList.contains("slim-btn-cancel")&&this._cancel(),t.target.classList.contains("slim-btn-confirm")&&this._confirm()}},{key:"_onResize",value:function(){var t=this;this._currentWindowSize={width:window.innerWidth,height:window.innerHeight},clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(function(){requestAnimationFrame(function(){t._reflow()})},10)}},{key:"_reflow",value:function(){var t=this._wrapper.offsetWidth;this._redraw(),this._cropper.rescale(this._wrapper.offsetWidth/t)}},{key:"_onGridInput",value:function(){this._maskOriginal()}},{key:"_onGridChange",value:function(){this._maskOriginal()}},{key:"_cancel",value:function(){this._element.dispatchEvent(new CustomEvent("cancel"))}},{key:"_confirm",value:function(){this._element.dispatchEvent(new CustomEvent("confirm",{detail:{crop:Q(this._cropper.area,this._input.width/this._preview.width)}}))}},{key:"dirty",value:function(){this._dirty=!0}},{key:"open",value:function(t,e,i,n){var o=this;if(this._input&&!this._dirty)return void n();this._dirty=!1,this._blurredPreview=!1,this._input=t,this._preview.onload=function(){o._redraw(),requestAnimationFrame(function(){var t=o.ratio;o._cropper.minWidth=o._options.minSize.width*o.scalar,o._cropper.minHeight=o._options.minSize.height*o.scalar,o._cropper.ratio=t;var e=o._stage.getBoundingClientRect();o._cropper.limit(e.width,e.height),o._cropper.resize(i.x*o.scalar,i.y*o.scalar,i.width*o.scalar,i.height*o.scalar),n(),o._element.style.opacity=""})};var r=Math.min(this._element.offsetWidth/this._input.width,this._element.offsetHeight/this._input.height);this._preview.src=J(this._input,r).toDataURL(),this._element.style.opacity="0",this._ratio=e}},{key:"_maskOriginal",value:function(){var t=this,e=this._cropper.area;requestAnimationFrame(function(){t._preview.style.clip="rect("+e.y+"px,"+(e.x+e.width)+"px,"+(e.y+e.height)+"px,"+e.x+"px)"})}},{key:"_reset",value:function(){this._blurredPreview=!1,this._preview.src="",Y(this._previewBlurred),this._cropper.reset()}},{key:"_redraw",value:function(){var t=this._input.height/this._input.width,e=this._btnGroup.offsetHeight,i=this._element.clientWidth,n=this._element.clientHeight-e,o=i,r=o*t;r>n&&(r=n,o=r/t),o=Math.round(o),r=Math.round(r),this._previewBlurred.style.cssText=this._wrapper.style.cssText="\n			width:"+o+"px;\n			height:"+r+"px;\n		",this._preview.width=o,this._preview.height=r,this._blurredPreview||(this._previewBlurred.width=300,this._previewBlurred.height=this._previewBlurred.width*t,X(this._input,this._previewBlurred),$(this._previewBlurred,3),this._blurredPreview=!0)}},{key:"show",value:function(){var t=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];this._currentWindowSize.width===window.innerWidth&&this._currentWindowSize.height===window.innerHeight||this._reflow(),document.addEventListener("keydown",this),window.addEventListener("resize",this),d(this._previewWrapper,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:.9999,fromScale:[.98,.98],scale:[1,1],easing:"spring",springConstant:.3,springDeceleration:.85,delay:450,complete:function(){T(this)}}),this._cropper.dirty?d(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:550,complete:function(){T(this),t()}}):d(this._stage,{fromPosition:[0,0,0],position:[0,0,0],fromOpacity:0,opacity:1,duration:250,delay:1e3,complete:function(){T(this)}}),d(this._btnGroup.childNodes,{fromScale:[.9,.9],scale:[1,1],fromOpacity:0,opacity:1,delay:function(t){return 1e3+100*t},easing:"spring",springConstant:.3,springDeceleration:.85,complete:function(){T(this)}})}},{key:"hide",value:function(){var t=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];document.removeEventListener("keydown",this),window.removeEventListener("resize",this),d(this._btnGroup.childNodes,{fromOpacity:1,opacity:0,duration:350}),d([this._stage,this._previewWrapper],{fromPosition:[0,0,0],position:[0,-250,0],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,delay:250,allDone:function(){t()}})}},{key:"destroy",value:function(){var t=this;ut(this._btnGroup.children).forEach(function(e){e.removeEventListener("click",t)}),e.forEach(function(e){t._cropper.element.removeEventListener(e,t)}),this._cropper.destroy(),lt(this._element)}},{key:"element",get:function(){return this._element}},{key:"ratio",get:function(){return"input"===this._ratio?this._input.height/this._input.width:this._ratio}},{key:"offset",get:function(){return this._element.getBoundingClientRect()}},{key:"original",get:function(){return this._input}},{key:"scalar",get:function(){return this._preview.width/this._input.width}}],[{key:"options",value:function(){return{buttonCancelClassName:null,buttonConfirmClassName:null,buttonCancelLabel:"Cancel",buttonConfirmLabel:"Confirm",buttonCancelTitle:null,buttonConfirmTitle:null,minSize:{width:0,height:0}}}}]),i}();return i.Buttons=["cancel","confirm"],i}(dt),ft=function(){var e=["dragover","dragleave","drop"];return function(){function i(){var e=arguments.length<=0||void 0===arguments[0]?document.createElement("div"):arguments[0];t(this,i),this._element=e,this._accept=[],this._dragPath=null,this._init()}return m(i,[{key:"areValidFiles",value:function(t){return!this._accept.length||!t||-1!=this._accept.indexOf(t[0].type)}},{key:"reset",value:function(){this._element.files=null}},{key:"_init",value:function(){var t=this;this._element.className="slim-file-hopper",e.forEach(function(e){t._element.addEventListener(e,t)})}},{key:"handleEvent",value:function(t){switch(t.type){case"dragover":this._onDragOver(t);break;case"dragleave":this._onDragLeave(t);break;case"drop":this._onDrop(t)}}},{key:"_onDrop",value:function(t){return t.preventDefault(),this.areValidFiles(t.dataTransfer.files)?(this._element.files=t.dataTransfer.files,this._element.dispatchEvent(new CustomEvent("file-drop",{detail:_(t)})),this._element.dispatchEvent(new CustomEvent("change")),void(this._dragPath=null)):(this._element.dispatchEvent(new CustomEvent("file-invalid-drop")),void(this._dragPath=null))}},{key:"_onDragOver",value:function(t){return t.preventDefault(),t.dataTransfer.dropEffect="copy",this.areValidFiles(t.dataTransfer.items)?(this._dragPath||(this._dragPath=[]),this._dragPath.push(_(t)),void this._element.dispatchEvent(new CustomEvent("file-over",{detail:{x:M(this._dragPath).x,y:M(this._dragPath).y}}))):(t.dataTransfer.dropEffect="none",void this._element.dispatchEvent(new CustomEvent("file-invalid")))}},{key:"_onDragLeave",value:function(t){this._element.dispatchEvent(new CustomEvent("file-out",{detail:_(t)})),this._dragPath=null}},{key:"destroy",value:function(){var t=this;e.forEach(function(e){t._element.removeEventListener(e,t)}),lt(this._element)}},{key:"element",get:function(){return this._element}},{key:"dragPath",get:function(){return this._dragPath}},{key:"enabled",get:function(){return""===this._element.style.display},set:function(t){this._element.style.display=t?"":"none"}},{key:"accept",set:function(t){this._accept=t},get:function(){return this._accept}}]),i}()}(),mt=function(){return function(){function e(){t(this,e),this._element=null,this._inner=null,this._init()}return m(e,[{key:"_init",value:function(){this._element=b("div","slim-popover"),this._element.setAttribute("data-state","off"),document.body.appendChild(this._element)}},{key:"show",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];this._element.setAttribute("data-state","on"),d(this._element,{fromOpacity:0,opacity:1,duration:350,complete:function(){T(t._element),e()}})}},{key:"hide",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];d(this._element,{fromOpacity:1,opacity:0,duration:500,complete:function(){T(t._element),t._element.setAttribute("data-state","off"),e()}})}},{key:"destroy",value:function(){this._element.parentNode&&this._element.parentNode.removeChild(this._element)}},{key:"inner",set:function(t){this._inner=t,this._element.firstChild&&this._element.removeChild(this._element.firstChild),this._element.appendChild(this._inner)}}]),e}()}(),gt=function(t,e){return t.split(e).map(function(t){return parseInt(t,10)})},_t=function(t){return"DIV"==t.nodeName},vt={AUTO:"auto",INITIAL:"initial",MANUAL:"manual"},yt=["x","y","width","height"],wt=["file-invalid-drop","file-invalid","file-drop","file-over","file-out","click"],bt=["cancel","confirm"],kt=["remove","edit","download","upload"],xt=null,Et=0,Ct='\n<div class="slim-loader">\n	<svg>\n		<path class="slim-loader-background" fill="none" stroke-width="3" />\n		<path class="slim-loader-foreground" fill="none" stroke-width="3" />\n	</svg>\n</div>\n',St='\n<div class="slim-upload-status"></div>\n',Mt=function(){function e(i){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),xt||(xt=new mt),Et++,this._options=v(e.options(),n),this._originalElement=i,this._originalElementInner=i.innerHTML,this._originalElementAttributes=g(i),_t(i)?this._element=i:(this._element=ht(i),this._element.className=i.className,i.className="",this._element.setAttribute("data-ratio",this._options.ratio)),this._element.classList.add("slim"),this._element.setAttribute("data-state","init"),this._input=null,this._output=null,this._ratio=null,this._isRequired=!1,this._imageHopper=null,this._imageEditor=null,this._progressEnabled=!0,this._data={},this._resetData(),this._state=[],this._drip=null,this._hasInitialImage=!1,this._initialCrop=this._options.crop,this._isBeingDestroyed=!1,e.supported?this._init():this._fallback()}return m(e,[{key:"isAttachedTo",value:function(t){return this._element===t||this._originalElement===t}},{key:"isDetached",value:function(){return null===this._element.parentNode}},{key:"load",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments[2];"function"==typeof e?i=e:(this._options.crop=e.crop,this._initialCrop=this._options.crop),this._load(t,i)}},{key:"upload",value:function(t){this._doUpload(t)}},{key:"download",value:function(){this._doDownload()}},{key:"remove",value:function(){return this._doRemove()}},{key:"destroy",value:function(){this._doDestroy()}},{key:"_getFileInput",value:function(){return this._element.querySelector("input[type=file]")}},{key:"_getInitialImage",value:function(){return this._element.querySelector("img")}},{key:"_getInputElement",value:function(){return this._getFileInput()||this._getInitialImage()}},{key:"_getRatioSpacerElement",value:function(){return this._element.children[0]}},{key:"_isImageOnly",value:function(){return"INPUT"!==this._input.nodeName}},{key:"_isFixedRatio",value:function(){return-1!==this._options.ratio.indexOf(":")}},{key:"_toggleButton",value:function(t,e){at('.slim-btn[data-action="'+t+'"]',e,this._element)}},{key:"_clearState",value:function(){this._state=[],this._updateState()}},{key:"_removeState",value:function(t){this._state=this._state.filter(function(e){return e!==t}),this._updateState()}},{key:"_addState",value:function(t){A(t,this._state)||(this._state.push(t),this._updateState())}},{key:"_updateState",value:function(){this._element.setAttribute("data-state",this._state.join(","))}},{key:"_resetData",value:function(){this._data={server:null,meta:null,input:{image:null,name:null,type:null,width:0,height:0},output:{image:null,width:0,height:0},actions:{crop:null,size:null}},this._output&&(this._output.value=""),et(this._getFileInput())}},{key:"_init",value:function(){var t=this;this._isInitialising=!0,this._addState("empty"),this._input=this._getInputElement(),this._input||(this._input=b("input"),this._input.type="file",this._element.appendChild(this._input)),this._isRequired=this._input.required===!0,this._output=this._element.querySelector("input[type=hidden]"),this._output||(this._output=b("input"),this._output.type="hidden",this._output.name=this._input.name||this._options.defaultInputName,this._element.appendChild(this._output)),this._input.removeAttribute("name");var e=b("div","slim-area"),i=this._getInitialImage(),n=(i||{}).src;n?this._hasInitialImage=!0:this._initialCrop=null;var o='\n		<div class="slim-result">\n			<img class="in" style="opacity:0" '+(n?'src="'+n+'"':"")+'><img><img style="opacity:0">\n		</div>';if(this._isImageOnly())e.innerHTML="\n				"+Ct+"\n				"+St+"\n				"+o+"\n			";else{var r=void 0;this._input.hasAttribute("accept")&&"image/*"!==this._input.getAttribute("accept")?r=this._input.accept.split(",").filter(function(t){return t.length>0}):(r=D(),this._input.setAttribute("accept",r.join(","))),this._imageHopper=new ft,this._imageHopper.accept=r,this._element.appendChild(this._imageHopper.element),wt.forEach(function(e){t._imageHopper.element.addEventListener(e,t)}),e.innerHTML="\n				"+Ct+"\n				"+St+'\n				<div class="slim-drip"><span><span></span></span></div>\n				<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+"</div></div>\n				"+o+"\n			",this._input.addEventListener("change",this)}if(this._element.appendChild(e),this._btnGroup=b("div","slim-btn-group"),this._btnGroup.style.display="none",this._element.appendChild(this._btnGroup),kt.filter(function(e){return t._isButtonAllowed(e)}).forEach(function(e){var i=S(e),n=t._options["button"+i+"Label"],o=t._options["button"+i+"Title"]||n,r=t._options["button"+i+"ClassName"],s=b("button","slim-btn slim-btn-"+e+(r?" "+r:""));s.innerHTML=n,s.title=o,s.type="button",s.addEventListener("click",t),s.setAttribute("data-action",e),t._btnGroup.appendChild(s)}),this._isFixedRatio()){var s=gt(this._options.ratio,":");this._ratio=s[1]/s[0],this._scaleDropArea(this._ratio)}this._updateProgress(.5),n?this._load(n,function(){t._onInit()}):this._onInit()}},{key:"_onInit",value:function(){var t=this;this._isInitialising=!1,setTimeout(function(){t._options.didInit.apply(t,[t.data])},0)}},{key:"_updateProgress",value:function(t){if(this._progressEnabled){var e=this._element.querySelector(".slim-loader");if(e){var i=e.getBoundingClientRect(),n=e.querySelectorAll("path"),o=parseInt(n[0].getAttribute("stroke-width"),10);n[0].setAttribute("d",ct(.5*i.width,.5*i.height,.5*i.width-o,.9999)),n[1].setAttribute("d",ct(.5*i.width,.5*i.height,.5*i.width-o,t))}}}},{key:"_startProgress",value:function(){var t=this;this._progressEnabled=!1;var e=this._element.querySelector(".slim-loader");if(e){var i=e.children[0];this._stopProgressLoop(function(){e.removeAttribute("style"),i.removeAttribute("style"),t._progressEnabled=!0,t._updateProgress(0),t._progressEnabled=!1,d(i,{fromOpacity:0,opacity:1,duration:250,complete:function(){t._progressEnabled=!0}})})}}},{key:"_stopProgress",value:function(){var t=this,e=this._element.querySelector(".slim-loader");if(e){var i=e.children[0];this._updateProgress(1),d(i,{fromOpacity:1,opacity:0,duration:250,complete:function(){e.removeAttribute("style"),i.removeAttribute("style"),t._updateProgress(.5),t._progressEnabled=!1}})}}},{key:"_startProgressLoop",value:function(){var t=this._element.querySelector(".slim-loader");if(t){var e=t.children[0];t.removeAttribute("style"),e.removeAttribute("style"),this._updateProgress(.5);var i=1e3;d(t,{rotation:[0,0,-(2*Math.PI)*i],easing:"linear",duration:1e3*i}),d(e,{fromOpacity:0,opacity:1,duration:250})}}},{key:"_stopProgressLoop",value:function(t){var e=this._element.querySelector(".slim-loader");if(e){var i=e.children[0];d(i,{fromOpacity:parseFloat(i.style.opacity),opacity:0,duration:250,complete:function(){d(e,"stop"),t&&t()}})}}},{key:"_isButtonAllowed",value:function(t){return"edit"===t?this._options.edit:"download"===t?this._options.download:"upload"===t?!!this._options.service&&!this._options.push:"remove"!==t||!this._isImageOnly()}},{key:"_fallback",value:function(){this._removeState("init");var t=b("div","slim-area");t.innerHTML='\n			<div class="slim-status"><div class="slim-label">'+(this._options.label||"")+"</div></div>\n		",this._element.appendChild(t),this._throwError(this._options.statusNoSupport)}},{key:"handleEvent",value:function(t){switch(t.type){case"click":this._onClick(t);break;case"change":this._onChange(t);break;case"cancel":this._onCancel(t);break;case"confirm":this._onConfirm(t);break;case"file-over":this._onFileOver(t);break;case"file-out":this._onFileOut(t);break;case"file-drop":this._onDropFile(t);break;case"file-invalid":this._onInvalidFile(t);break;case"file-invalid-drop":this._onInvalidFileDrop(t)}}},{key:"_getIntro",value:function(){return this._element.querySelector(".slim-result .in")}},{key:"_getOutro",value:function(){return this._element.querySelector(".slim-result .out")}},{key:"_getInOut",value:function(){return this._element.querySelectorAll(".slim-result img")}},{key:"_getDrip",value:function(){return this._drip||(this._drip=this._element.querySelector(".slim-drip > span")),this._drip}},{key:"_throwError",value:function(t){this._addState("error"),this._element.querySelector(".slim-label").style.display="none";var e=this._element.querySelector(".slim-error");e||(e=b("div","slim-error"),this._element.querySelector(".slim-status").appendChild(e)),e.innerHTML=t}},{key:"_removeError",value:function(){this._removeState("error"),this._element.querySelector(".slim-label").style.display="";var t=this._element.querySelector(".slim-error");t&&t.parentNode.removeChild(t)}},{key:"_openFileDialog",value:function(){this._removeError(),this._input.click()}},{key:"_onClick",value:function(t){var e=this,i=t.target.classList,n=t.target;if(i.contains("slim-file-hopper"))return void this._openFileDialog();switch(n.getAttribute("data-action")){case"remove":this._options.willRemove.apply(this,[this.data,function(){e._doRemove()}]);break;case"edit":this._doEdit();break;case"download":this._doDownload();break;case"upload":this._doUpload()}}},{key:"_onInvalidFileDrop",value:function(){this._onInvalidFile(),this._removeState("file-over");var t=this._getDrip();d(t.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){T(t.firstChild)}})}},{key:"_onInvalidFile",value:function(){var t=this._imageHopper.accept.map(U),e=this._options.statusFileType.replace("$0",t.join(", "));this._throwError(e)}},{key:"_onImageTooSmall",value:function(){var t=this._options.statusImageTooSmall.replace("$0",this._options.minSize.width+"  "+this._options.minSize.height);this._throwError(t)}},{key:"_onOverWeightFile",value:function(){var t=this._options.statusFileSize.replace("$0",this._options.maxFileSize);this._throwError(t)}},{key:"_onFileOver",value:function(t){this._addState("file-over"),this._removeError();var e=this._getDrip(),i=d.createMatrix();i.translate(t.detail.x,t.detail.y,0),d.setElementTransform(e,i),1==this._imageHopper.dragPath.length&&(e.style.opacity=1,d(e.firstChild,{fromOpacity:0,opacity:.5,fromScale:[0,0],scale:[.5,.5],duration:150}))}},{key:"_onFileOut",value:function(t){this._removeState("file-over"),this._removeState("file-invalid"),this._removeError();var e=this._getDrip(),i=d.createMatrix();i.translate(t.detail.x,t.detail.y,0),d.setElementTransform(e,i),d(e.firstChild,{fromScale:[.5,.5],scale:[0,0],fromOpacity:.5,opacity:0,duration:150,complete:function(){T(e.firstChild)}})}},{key:"_onDropFile",value:function(t){var e=this;this._removeState("file-over");var i=this._getDrip(),n=d.createMatrix();n.translate(t.detail.x,t.detail.y,0),d.setElementTransform(i,n);var o=this._imageHopper.dragPath.length,r=this._imageHopper.dragPath[o-Math.min(10,o)],s=t.detail.x-r.x,a=t.detail.y-r.y;d(i,{fromPosition:[t.detail.x,t.detail.y,0],position:[t.detail.x+s,t.detail.y+a,0],duration:200}),d(i.firstChild,{fromScale:[.5,.5],scale:[2,2],fromOpacity:1,opacity:0,duration:200,complete:function(){T(i.firstChild),e._load(t.target.files[0])}})}},{key:"_onChange",value:function(t){this._load(t.target.files[0])}},{key:"_load",value:function(t,e){var i=this;if(!this._isBeingDestroyed){var n=H(t);if(this._imageHopper&&-1===this._imageHopper.accept.indexOf(n.type))return this._onInvalidFile(),void(e&&e.apply(this,["file-invalid"]));if(n.size&&this._options.maxFileSize&&I(n.size)>this._options.maxFileSize)return this._onOverWeightFile(),void(e&&e.apply(this,["file-too-big"]));this._removeState("empty"),this._imageHopper&&(this._imageHopper.enabled=!1),this._imageEditor&&this._imageEditor.dirty(),this._data.input.name=n.name,this._data.input.type=n.type,this._data.input.size=n.size,this._startProgressLoop(),this._addState("busy"),j(t,function(t,o){var r=function(){i._imageHopper&&(i._imageHopper.enabled=!0),i._removeState("busy"),i._stopProgressLoop(),i._resetData()};if(!t)return r(),void(e&&e.apply(i,["file-not-found"]));if(!K(t,i._options.minSize))return r(),i._onImageTooSmall(),void(e&&e.apply(i,["image-too-small"]));var s=i._options.didLoad.apply(i,[n,t,o]);return s!==!0?(r(),s!==!1&&i._throwError(s),void(e&&e.apply(i,[s]))):void i._loadCanvas(t,function(){var t=i._getIntro(),n={fromScale:[1.25,1.25],scale:[1,1],fromOpacity:0,opacity:1,complete:function(){T(t),t.style.opacity=1,i._showButtons(),i._stopProgressLoop(),i._removeState("busy"),i._addState("preview"),e&&e.apply(i,[null,i.data])}};i.isDetached()?n.duration=1:(n.easing="spring",n.springConstant=.3,n.springDeceleration=.7),d(t,n)})})}}},{key:"_loadCanvas",value:function(t,e){var i=this;this._isBeingDestroyed||(this._isFixedRatio()||(this._ratio=t.height/t.width,this._scaleDropArea(this._ratio)),this._data.input.image=t,this._data.input.width=t.width,this._data.input.height=t.height,this._initialCrop?(this._data.actions.crop=it(this._initialCrop),this._data.actions.crop.type=vt.INITIAL,this._initialCrop=null):(this._data.actions.crop=W(t.width,t.height,this._ratio),this._data.actions.crop.type=vt.AUTO),this._options.size&&(this._data.actions.size={width:this._options.size.width,height:this._options.size.height}),this._applyTransforms(t,function(t){var n=i._getIntro(),o=n.offsetWidth/t.width,r=!1;i._options.service&&i._options.push&&(i._hasInitialImage||(r=!0)),i._save(function(){},r),n.src="",n.src=J(t,o).toDataURL(),n.onload=function(){n.onload=null,i._isBeingDestroyed||e&&e()}}))}},{key:"_applyTransforms",value:function(t,e){var i=this;V(t,this._data.actions,function(t){i._data.output.width=t.width,i._data.output.height=t.height,i._data.output.image=t,i._onTransformCanvas(function(t){i._data=t,e(i._data.output.image)})})}},{key:"_onTransformCanvas",value:function(t){this._options.willTransform.apply(this,[this.data,t])}},{key:"_appendEditor",value:function(){var t=this;this._imageEditor||(this._imageEditor=new pt(b("div"),{minSize:this._options.minSize,buttonConfirmClassName:"slim-btn-confirm",buttonCancelClassName:"slim-btn-cancel",buttonConfirmLabel:this._options.buttonConfirmLabel,buttonCancelLabel:this._options.buttonCancelLabel,buttonConfirmTitle:this._options.buttonConfirmTitle,buttonCancelTitle:this._options.buttonCancelTitle}),bt.forEach(function(e){t._imageEditor.element.addEventListener(e,t)}))}},{key:"_scaleDropArea",value:function(t){var e=this._getRatioSpacerElement();e.style.marginBottom=100*t+"%",this._element.setAttribute("data-ratio","1:"+t)}},{key:"_onCancel",value:function(t){this._removeState("editor"),this._showButtons(),this._hideEditor()}},{key:"_onConfirm",value:function(t){var e=this;this._removeState("editor"),this._startProgressLoop(),this._addState("busy"),this._output.value="",this._data.actions.crop=t.detail.crop,this._data.actions.crop.type=vt.MANUAL,this._applyTransforms(this._data.input.image,function(t){var i=e._getInOut(),n="out"===i[0].className?i[0]:i[1],o=n===i[0]?i[1]:i[0];n.className="in",n.style.opacity="0",n.style.zIndex="2",o.className="out",o.style.zIndex="1",n.src="",n.src=J(t,n.offsetWidth/t.width).toDataURL(),n.onload=function(){n.onload=null,"free"===e._options.ratio&&(e._ratio=n.naturalHeight/n.naturalWidth,e._scaleDropArea(e._ratio)),e._hideEditor(),setTimeout(function(){e._showPreview(n,function(){var t=e._options.service&&e._options.push;e._save(function(t,i,n){e._toggleButton("upload",!0),e._stopProgressLoop(),e._removeState("busy"),e._showButtons()},t)})},250)}})}},{key:"_save",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0],i=arguments.length<=1||void 0===arguments[1]||arguments[1],n=this.dataBase64;this._options.service||this._isInitialising&&!this._isImageOnly()||this._options.willSave.apply(this,[n,function(e){t._store(e),t._options.didSave.apply(t,[e])}]),this._options.service&&i&&this._options.willSave.apply(this,[n,function(i){t._upload(i,function(n,o){n||t._storeServerResponse(o),t._options.didUpload.apply(t,[n,i,o]),e(n,i,o)})}]),this._options.service&&i||e()}},{key:"_storeServerResponse",value:function(t){this._isRequired&&(this._input.required=!1),this._data.server=t,this._output.value="object"===("undefined"==typeof t?"undefined":f(t))?JSON.stringify(this._data.server):t}},{key:"_store",value:function(t){this._isRequired&&(this._input.required=!1),this._output.value=JSON.stringify(t)}},{key:"_upload",value:function(t,e){var i=this,n=new FormData;n.append(this._output.name,JSON.stringify(t));var o=this._element.querySelector(".slim-upload-status");O(this._options.service,n,function(t,e){i._updateProgress(t/e)},function(t){setTimeout(function(){o.innerHTML=i._options.statusUploadSuccess,o.setAttribute("data-state","success"),o.style.opacity=1,setTimeout(function(){o.style.opacity=0},2e3)},250),e(null,t)},function(t){var n="";n="file-too-big"===t?i._options.statusContentLength:i._options.statusUnknownResponse,setTimeout(function(){o.innerHTML=n,o.setAttribute("data-state","error"),o.style.opacity=1},250),e(t)})}},{key:"_showEditor",value:function(){xt.show(),this._imageEditor.show()}},{key:"_hideEditor",value:function(){this._imageEditor.hide(),setTimeout(function(){xt.hide()},250)}},{key:"_showPreview",value:function(t,e){d(t,{fromPosition:[0,50,0],position:[0,0,0],fromScale:[1.5,1.5],scale:[1,1],fromOpacity:0,opacity:1,easing:"spring",springConstant:.3,springDeceleration:.7,complete:function(){T(t),e&&e()}})}},{key:"_hideResult",value:function(t){var e=this._getIntro();e&&d(e,{fromScale:[1,1],scale:[.5,.5],fromOpacity:1,opacity:0,easing:"spring",springConstant:.3,springDeceleration:.75,complete:function(){T(e),t&&t()}})}},{key:"_showButtons",value:function(t){this._btnGroup.style.display="";var e={fromScale:[.5,.5],scale:[1,1],fromPosition:[0,10,0],position:[0,0,0],fromOpacity:0,opacity:1,complete:function(){T(this)},allDone:function(){t&&t()}};this.isDetached()?e.duration=1:(e.delay=function(t){return 250+50*t},e.easing="spring",e.springConstant=.3,e.springDeceleration=.85),d(this._btnGroup.childNodes,e)}},{key:"_hideButtons",value:function(t){var e=this,i={fromScale:[1,1],scale:[.85,.85],fromOpacity:1,opacity:0,allDone:function(){e._btnGroup.style.display="none",t&&t()}};this.isDetached()?i.duration=1:(i.easing="spring",i.springConstant=.3,i.springDeceleration=.75),d(this._btnGroup.childNodes,i)}},{key:"_hideStatus",value:function(){var t=this._element.querySelector(".slim-upload-status");t.style.opacity=0}},{key:"_doEdit",value:function(){var t=this;this._data.input.image&&(this._addState("editor"),this._imageEditor||this._appendEditor(),xt.inner=this._imageEditor.element,this._imageEditor.open(G(this._data.input.image),"free"===this._options.ratio?null:this._ratio,this._data.actions.crop,function(){t._showEditor(),t._hideButtons(),t._hideStatus()}))}},{key:"_doRemove",value:function(){var t=this;if(!this._isImageOnly()){this._clearState(),this._addState("empty"),this._hasInitialImage=!1,this._imageHopper.enabled=!0,this._isRequired&&(this._input.required=!0);var e=this._getOutro();e&&(e.style.opacity="0");var i=this.data;return this._resetData(),setTimeout(function(){t._isBeingDestroyed||(t._hideButtons(function(){t._toggleButton("upload",!0)}),t._hideStatus(),t._hideResult(),t._options.didRemove.apply(t,[i]))},this.isDetached()?0:250),i}}},{key:"_doUpload",value:function(t){var e=this;this._data.input.image&&(this._addState("upload"),this._startProgress(),this._hideButtons(function(){e._toggleButton("upload",!1),e._save(function(i,n,o){e._removeState("upload"),e._stopProgress(),t&&t.apply(e,[i,n,o]),i&&e._toggleButton("upload",!0),e._showButtons()})}))}},{key:"_doDownload",value:function(){var t=this._data.output.image;t&&Z(t,this._data.input.name,this._data.input.type)}},{key:"_doDestroy",value:function(){function t(t,e){return 0!==e.filter(function(e){return t.name===e.name&&t.value===e.value}).length}var e=this;this._isBeingDestroyed=!0,this._imageHopper&&(wt.forEach(function(t){e._imageHopper.element.removeEventListener(t,e)}),this._imageHopper.destroy()),this._imageEditor&&(bt.forEach(function(t){e._imageEditor.element.removeEventListener(t,e)}),this._imageEditor.destroy()),ut(this._btnGroup.children).forEach(function(t){t.removeEventListener("click",e)}),this._input.removeEventListener("change",this),this._element!==this._originalElement&&this._element.parentNode&&this._element.parentNode.replaceChild(this._originalElement,this._element),this._originalElement.innerHTML=this._originalElementInner;var i=g(this._originalElement);i.forEach(function(i){t(i,e._originalElementAttributes)||e._originalElement.removeAttribute(i.name)}),this._originalElementAttributes.forEach(function(n){t(n,i)||e._originalElement.setAttribute(n.name,n.value)}),Et=Math.max(0,Et-1),xt&&0===Et&&(xt.destroy(),xt=null)}},{key:"dataBase64",get:function(){return st(this._data,this._options.post,this._options.jpegCompression)}},{key:"data",get:function(){return nt(this._data)}},{key:"element",get:function(){return this._element}}],[{key:"options",value:function(){var t={edit:!0,ratio:"free",size:null,crop:null,post:["output","actions"],service:null,push:!1,defaultInputName:"slim[]",minSize:{width:100,height:100},maxFileSize:null,jpegCompression:null,download:!1,label:"<p>Drop your image here</p>",statusFileType:"<p>Invalid file type, expects: $0.</p>",statusFileSize:"<p>File is too big, maximum file size: $0 MB.</p>",statusNoSupport:"<p>Your browser does not support image cropping.</p>",statusImageTooSmall:"<p>Image is too small, minimum size is: $0 pixels.</p>",statusContentLength:'<span class="slim-upload-status-icon"></span> The file is probably too big',statusUnknownResponse:'<span class="slim-upload-status-icon"></span> An unknown error occurred',statusUploadSuccess:'<span class="slim-upload-status-icon"></span> Saved',didInit:function(t){},didLoad:function(t,e,i){return!0},didSave:function(t){},didUpload:function(t,e,i){},didRemove:function(t){},willTransform:function(t,e){e(t)},willSave:function(t,e){e(t)},willRemove:function(t,e){e()}};return kt.concat(pt.Buttons).forEach(function(e){var i=S(e);t["button"+i+"ClassName"]=null,t["button"+i+"Label"]=i,t["button"+i+"Title"]=null}),t}}]),e}();return function(){function t(t,e){return t.getAttribute("data-"+e)}function e(t){return t.replace(/([a-z](?=[A-Z]))/g,"$1-").toLowerCase()}function i(t){return"object"===("undefined"==typeof t?"undefined":f(t))?JSON.parse(JSON.stringify(t)):t}function n(t){return t?"<p>"+t+"</p>":null}function o(t){var e=window,i=t.split(".");return i.forEach(function(t,n){e=e[i[n]]}),e}var r=[],s=function(t){for(var e=0,i=r.length;i>e;e++)if(r[e].isAttachedTo(t))return e;return-1},a=function(t,e){return e},u=function(t,e){return"true"===e},l=function(t,e){return!e||"true"===e},h=function(t,e){return n(e)},c=function(t,e){return e?o(e):null},d=function(t,e){if(!e)return null;var i=gt(e,",");return{width:i[0],height:i[1]}},p=function(t,e){return e?parseFloat(e):null},m=function(t,e){return e?parseInt(e,10):null},g=function(t,e){if(!e)return null;var i={};
    return e.split(",").map(function(t){return parseInt(t,10)}).forEach(function(t,e){i[yt[e]]=t}),i},_={download:u,edit:l,minSize:d,size:d,service:function(t,e){return"undefined"==typeof e?null:e},push:u,crop:g,post:function(t,e){return e?e.split(",").map(function(t){return t.trim()}):null},defaultInputName:a,ratio:function(t,e){return e?e:null},maxFileSize:p,jpegCompression:m,label:h};["FileSize","FileType","NoSupport","ImageTooSmall"].forEach(function(t){_["status"+t]=h}),["ContentLength","UnknownResponse","UploadSuccess"].forEach(function(t){_["status"+t]=a}),["Init","Load","Save","Upload","Remove"].forEach(function(t){_["did"+t]=c}),["Transform","Save","Remove"].forEach(function(t){_["will"+t]=c});var v=["ClassName","Label","Title"];kt.concat(pt.Buttons).forEach(function(t){var e=S(t);v.forEach(function(t){_["button"+e+t]=a})}),Mt.supported=function(){return"undefined"!=typeof window.FileReader}(),Mt.parse=function(n){var o,r,s,a,u,l,h=[];for(o=n.querySelectorAll(".slim:not([data-state])"),s=o.length;s--;){r=o[s],a={};for(l in _)_.hasOwnProperty(l)&&(u=_[l](r,t(r,e(l))),a[l]=null===u?i(Mt.options()[l]):u);h.push(Mt.create(r,a))}return h},Mt.find=function(t){var e=r.filter(function(e){return e.isAttachedTo(t)});return e?e[0]:null},Mt.create=function(t,e){if(!Mt.find(t)){var i=new Mt(t,e);return r.push(i),i}},Mt.destroy=function(t){var e=s(t);return!(0>e||(r[e].destroy(),r[e]=null,r.splice(e,1),0))}}(),Mt}),define("ui/Demo",["slim"],function(t){"use strict";var e=function(e){t.parse(e)};return e});